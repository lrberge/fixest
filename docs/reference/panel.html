<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Constructs a fixest panel data base out of a data.frame which allows to use leads and lags in fixest estimations and to create new variables from leads and lags if the data.frame was also a data.table::data.table."><title>Constructs a fixest panel data base — panel • fixest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Constructs a fixest panel data base — panel"><meta property="og:description" content="Constructs a fixest panel data base out of a data.frame which allows to use leads and lags in fixest estimations and to create new variables from leads and lags if the data.frame was also a data.table::data.table."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.11.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a>
    <a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a>
    <a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Estimation tables</h6>
    <a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a>
    <a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Constructs a <code>fixest</code> panel data base</h1>
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/R/Lagging.R" class="external-link"><code>R/Lagging.R</code></a></small>
      <div class="d-none name"><code>panel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Constructs a <code>fixest</code> panel data base out of a data.frame which allows to use leads and lags in <code>fixest</code> estimations and to create new variables from leads and lags if the data.frame was also a <code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">panel</span><span class="op">(</span><span class="va">data</span>, <span class="va">panel.id</span>, time.step <span class="op">=</span> <span class="cn">NULL</span>, duplicate.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"first"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data.frame.</p></dd>


<dt>panel.id</dt>
<dd><p>The panel identifiers. Can either be: i) a one sided formula (e.g. <code>panel.id = ~id+time</code>), ii) a character vector of length 2 (e.g. <code>panel.id=c('id', 'time')</code>, or iii) a character scalar of two variables separated by a comma (e.g. <code>panel.id='id,time'</code>). Note that you can combine variables with <code>^</code> only inside formulas (see the dedicated section in <code><a href="feols.html">feols</a></code>).</p></dd>


<dt>time.step</dt>
<dd><p>The method to compute the lags, default is <code>NULL</code> (which means automatically set). Can be equal to: <code>"unitary"</code>, <code>"consecutive"</code>, <code>"within.consecutive"</code>, or to a number. If <code>"unitary"</code>, then the largest common divisor between consecutive time periods is used (typically if the time variable represents years, it will be 1). This method can apply only to integer (or convertible to integer) variables. If <code>"consecutive"</code>, then the time variable can be of any type: two successive time periods represent a lag of 1. If <code>"witihn.consecutive"</code> then <strong>within a given id</strong>, two successive time periods represent a lag of 1. Finally, if the time variable is numeric, you can provide your own numeric time step.</p></dd>


<dt>duplicate.method</dt>
<dd><p>If several observations have the same id and time values, then the notion of lag is not defined for them. If <code>duplicate.method = "none"</code> (default) and duplicate values are found, this leads to an error. You can use <code>duplicate.method = "first"</code> so that the first occurrence of identical id/time observations will be used as lag.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>It returns a data base identical to the one given in input, but with an additional attribute: “panel_info”. This attribute contains vectors used to efficiently create lags/leads of the data. When the data is subselected, some bookeeping is performed on the attribute “panel_info”.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function allows you to use leads and lags in a <code>fixest</code> estimation without having to provide the argument <code>panel.id</code>. It also offers more options on how to set the panel (with the additional arguments 'time.step' and 'duplicate.method').</p>
<p>When the initial data set was also a <code>data.table</code>, not all operations are supported and some may dissolve the <code>fixest_panel</code>. This is the case when creating subselections of the initial data with additional attributes (e.g. <code>pdt[x&gt;0, .(x, y, z)]</code> would dissolve the <code>fixest_panel</code>, meaning only a data.table would be the result of the call).</p>
<p>If the initial data set was also a <code>data.table</code>, then you can create new variables from lags and leads using the functions <code><a href="l.html">l</a></code> and <code><a href="l.html">f</a></code>. See the example.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The estimation methods <code><a href="feols.html">feols</a></code>, <code><a href="feglm.html">fepois</a></code> and <code><a href="feglm.html">feglm</a></code>.</p>
<p>The functions <code><a href="l.html">l</a></code> and <code><a href="l.html">f</a></code> to create lags and leads within <code>fixest_panel</code> objects.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Laurent Berge</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Setting a data set as a panel...</span></span></span>
<span class="r-in"><span><span class="va">pdat</span> <span class="op">=</span> <span class="fu">panel</span><span class="op">(</span><span class="va">base_did</span>, <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ...then using the functions l and f</span></span></span>
<span class="r-in"><span><span class="va">est1</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NOTE: 108 observations removed because of NA values (RHS: 108).</span>
<span class="r-in"><span><span class="va">est2</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="l.html">f</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span>
<span class="r-in"><span><span class="va">est3</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NOTE: 324 observations removed because of NA values (LHS: 108, RHS: 324).</span>
<span class="r-in"><span><span class="fu"><a href="etable.html">etable</a></span><span class="op">(</span><span class="va">est1</span>, <span class="va">est2</span>, <span class="va">est3</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"^x"</span><span class="op">)</span>, drop<span class="op">=</span><span class="st">"Int"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                               est1               est2               est3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dependent Var.:                  y             f(y,1)             l(y,1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                                         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f(x1,1)                            0.9940*** (0.0542)                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1              0.9948*** (0.0487)    0.0081 (0.0592)   -0.0534 (0.0545)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Constant         2.235*** (0.2032)  2.464*** (0.2233)  2.196*** (0.2110)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l(x1,1)            0.0410 (0.0558)    0.0157 (0.0640) 0.9871*** (0.0551)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l(x1,2)                                                  0.0220 (0.0580)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l(x1,3)                                                  0.0102 (0.0639)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> _______________ __________________ __________________ __________________</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> S.E.: Clustered             by: id             by: id             by: id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations                   972                864                756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R2                         0.26558            0.25697            0.25875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Adj. R2                    0.26406            0.25438            0.25480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or using the argument panel.id</span></span></span>
<span class="r-in"><span><span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="l.html">f</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OLS estimation, Dep. Var.: f(y, 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations: 864 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard-errors: Clustered (id) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error   t value  Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 2.464313   0.223277 11.037009 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> f(x1, 1)    0.994018   0.054216 18.334504 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1          0.008072   0.059247  0.136241   0.89189    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> l(x1, 1)    0.015693   0.063958  0.245360   0.80665    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE: 4.97418   Adj. R2: 0.254377</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># You can use panel.id in various ways:</span></span></span>
<span class="r-in"><span><span class="va">pdat</span> <span class="op">=</span> <span class="fu">panel</span><span class="op">(</span><span class="va">base_did</span>, <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># is identical to:</span></span></span>
<span class="r-in"><span><span class="va">pdat</span> <span class="op">=</span> <span class="fu">panel</span><span class="op">(</span><span class="va">base_did</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># and also to:</span></span></span>
<span class="r-in"><span><span class="va">pdat</span> <span class="op">=</span> <span class="fu">panel</span><span class="op">(</span><span class="va">base_did</span>, <span class="st">"id,period"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># l() and f() can also be used within a data.table:</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://r-datatable.com" class="external-link">"data.table"</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">pdat_dt</span> <span class="op">=</span> <span class="fu">panel</span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span>, <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Now since pdat_dt is also a data.table</span></span></span>
<span class="r-in"><span>  <span class="co">#   you can create lags/leads directly</span></span></span>
<span class="r-in"><span>  <span class="va">pdat_dt</span><span class="op">[</span>, <span class="va">x1_l1</span> <span class="op">:=</span> <span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">pdat_dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1_l1_fill0"</span>, <span class="st">"y_f2"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="l.html">f</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

