<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This is a function advanced users which allows to estimate any fixest estimation from a fixest environment obtained with only.env = TRUE in a fixest estimation."><title>Estimates a fixest estimation from a fixest environment — est_env • fixest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimates a fixest estimation from a fixest environment — est_env"><meta property="og:description" content="This is a function advanced users which allows to estimate any fixest estimation from a fixest environment obtained with only.env = TRUE in a fixest estimation."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.11.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a>
    <a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a>
    <a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Estimation tables</h6>
    <a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a>
    <a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimates a <code>fixest</code> estimation from a <code>fixest</code> environment</h1>
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/R/ESTIMATION_FUNS.R" class="external-link"><code>R/ESTIMATION_FUNS.R</code></a></small>
      <div class="d-none name"><code>est_env.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is a function advanced users which allows to estimate any <code>fixest</code> estimation from a <code>fixest</code> environment obtained with <code>only.env = TRUE</code> in a <code>fixest</code> estimation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">est_env</span><span class="op">(</span><span class="va">env</span>, <span class="va">y</span>, <span class="va">X</span>, <span class="va">weights</span>, <span class="va">endo</span>, <span class="va">inst</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>env</dt>
<dd><p>An environment obtained from a <code>fixest</code> estimation with <code>only.env = TRUE</code>. This is intended for advanced users so there is no error handling: any other kind of input will fail with a poor error message.</p></dd>


<dt>y</dt>
<dd><p>A vector representing the dependent variable. Should be of the same length as the number of observations in the initial estimation.</p></dd>


<dt>X</dt>
<dd><p>A matrix representing the independent variables. Should be of the same dimension as in the initial estimation.</p></dd>


<dt>weights</dt>
<dd><p>A vector of weights (i.e. with only positive values). Should be of the same length as the number of observations in the initial estimation. If identical to the scalar 1, this will mean that no weights will be used in the estimation.</p></dd>


<dt>endo</dt>
<dd><p>A matrix representing the endogenous regressors in IV estimations. It should be of the same dimension as the original endogenous regressors.</p></dd>


<dt>inst</dt>
<dd><p>A matrix representing the instruments in IV estimations. It should be of the same dimension as the original instruments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>It returns the results of a <code>fixest</code> estimation: the one that was summoned when obtaining the environment.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function has been created for advanced users, mostly to avoid overheads when making simulations with <code>fixest</code>.</p>
<p>How can it help you make simulations? First make a core estimation with <code>only.env = TRUE</code>, and usually with <code>only.coef = TRUE</code> (to avoid having extra things that take time to compute). Then loop while modifying the appropriate things directly in the environment. Beware that if you make a mistake here (typically giving stuff of the wrong length), then you can make the R session crash because there is no more error-handling! Finally estimate with <code>est_env(env = core_env)</code> and store the results.</p>
<p>Instead of <code>est_env</code>, you could use directly <code>fixest</code> estimations too, like <code>feols</code>, since they accept the <code>env</code> argument. The function <code>est_env</code> is only here to add a bit of generality to avoid the trouble to the user to write conditions (look at the source, it's just a one liner).</p>
<p>Objects of main interest in the environment are:</p><ul><li><p>lhsThe left hand side, or dependent variable.</p></li>
<li><p>linear.matThe matrix of the right-hand-side, or explanatory variables.</p></li>
<li><p>iv_lhsThe matrix of the endogenous variables in IV regressions.</p></li>
<li><p>iv.matThe matrix of the instruments in IV regressions.</p></li>
<li><p>weights.valueThe vector of weights.</p></li>
</ul><p>I strongly discourage changing the dimension of any of these elements, or else crash can occur. However, you can change their values at will (given the dimension stay the same). The only exception is the weights, which tolerates changing its dimension: it can be identical to the scalar <code>1</code> (meaning no weights), or to something of the length the number of observations.</p>
<p>I also discourage changing anything in the fixed-effects (even their value) since this will almost surely lead to a crash.</p>
<p>Note that this function is mostly useful when the overheads/estimation ratio is high. This means that OLS will benefit the most from this function. For GLM/Max.Lik. estimations, the ratio is small since the overheads is only a tiny portion of the total estimation time. Hence this function will be less useful for these models.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Laurent Berge</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's make a short simulation</span></span></span>
<span class="r-in"><span><span class="co"># Inspired from Grant McDermott bboot function</span></span></span>
<span class="r-in"><span><span class="co"># See https://twitter.com/grant_mcdermott/status/1487528757418102787</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simple function that computes a Bayesian bootstrap</span></span></span>
<span class="r-in"><span><span class="va">bboot</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n_sim</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># We bootstrap on the weights</span></span></span>
<span class="r-in"><span>  <span class="co"># Works with fixed-effects/IVs</span></span></span>
<span class="r-in"><span>  <span class="co">#  and with any fixest function that accepts weights</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">core_env</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">x</span>, only.coef <span class="op">=</span> <span class="cn">TRUE</span>, only.env <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">n_obs</span> <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">nobs</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">res_all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n_sim</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># # begin: NOT RUN</span></span></span>
<span class="r-in"><span>    <span class="co"># # We could directly assign in the environment:</span></span></span>
<span class="r-in"><span>    <span class="co"># assign("weights.value", rexp(n_obs, rate = 1), core_env)</span></span></span>
<span class="r-in"><span>    <span class="co"># res_all[[i]] = est_env(env = core_env)</span></span></span>
<span class="r-in"><span>    <span class="co">#   end: NOT RUN</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Instead we can use the argument weights, which does the same</span></span></span>
<span class="r-in"><span>    <span class="va">res_all</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu">est_env</span><span class="op">(</span>env <span class="op">=</span> <span class="va">core_env</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n_obs</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">res_all</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="feols.html">feols</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">hp</span>, <span class="va">mtcars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">boot_res</span> <span class="op">=</span> <span class="fu">bboot</span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coef</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">boot_res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">std_err</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_res</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Comparing the results with the main estimation</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coeftable.html">coeftable</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Estimate Std. Error   t value     Pr(&gt;|t|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 37.22727012 1.59878754 23.284689 2.565459e-20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wt          -3.87783074 0.63273349 -6.128695 1.119647e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hp          -0.03177295 0.00902971 -3.518712 1.451229e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"type")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "IID"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coef</span>, <span class="va">std_err</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    coef     std_err</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 37.06416839 1.878346352</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> wt          -3.82426295 0.613391938</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hp          -0.03262888 0.006218552</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

