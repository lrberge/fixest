<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fixest">
<title>On standard-errors • fixest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="On standard-errors">
<meta property="og:description" content="fixest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.11.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a>
    <a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a>
    <a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Estimation tables</h6>
    <a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a>
    <a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>On standard-errors</h1>
                        <h4 data-toc-skip class="author">Laurent
Berge</h4>
            
            <h4 data-toc-skip class="date">2023-09-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/vignettes/standard_errors.Rmd" class="external-link"><code>vignettes/standard_errors.Rmd</code></a></small>
      <div class="d-none name"><code>standard_errors.Rmd</code></div>
    </div>

    
    
<p>It is an euphemism to say that standard-errors are a critical element
of your estimations: literally your paper’s results depend on them. It
is therefore unfortunate that no conventional “best” way exists to
compute them.</p>
<p>For example, when performing the exact same estimation across various
software, it is not uncommon to obtain different standard-errors. If
your first thought is: there must be a bug… well, put that thought aside
because there ain’t no bug. It often boils down to the choices the
developer made regarding small sample correction which, maybe
surprisingly, has many degrees of freedom when it comes to
implementation.</p>
<p>Multiple definitions can create confusion and the purpose of this
document is to lay bare the fiddly details of standard-error computation
in this package.</p>
<p>The first part of this vignette describes how standard-errors are
computed in <code>fixest</code>’s estimations. In particular, it details
all the possible choices surrounding small sample correction. Please
note that here I don’t discuss the <em>why</em>, but only the
<em>how</em>. For a thorough introduction to the topic, see the
excellent paper by <a href="https://cran.r-project.org/package=sandwich/vignettes/sandwich-CL.pdf" class="external-link">Zeileis,
Koll and Graham (2020)</a>. The second part illustrates how to replicate
some standard-errors obtained from other estimation methods with
<code>fixest</code>.</p>
<p>This document applies to <code>fixest</code> version 0.10.0 or
higher.</p>
<div class="section level2">
<h2 id="how-standard-errors-are-computed-in-fixest">How standard-errors are computed in <code>fixest</code><a class="anchor" aria-label="anchor" href="#how-standard-errors-are-computed-in-fixest"></a>
</h2>
<p>There are two components defining the standard-errors in
<code>fixest</code>. The main type of standard-error is given by the
argument <code>vcov</code>, the small sample correction is defined by
the argument <code>ssc</code>.</p>
<p>Here’s an example, the explanations follow in the next two
sections:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span></span>
<span><span class="co"># OLS estimation</span></span>
<span><span class="va">gravity</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Euros</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></span>
<span><span class="co"># Two-way clustered SEs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity</span>, vcov <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; OLS estimation, Dep. Var.: log(Euros)</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Fixed-effects: Destination: 15,  Origin: 15,  Product: 20,  Year: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Destination &amp; Origin) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; log(dist_km) -2.16988   0.171367 -12.6621 4.6802e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 1.74337     Adj. R2: 0.705139</span></span>
<span><span class="co">#&gt;                 Within R2: 0.219322</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Two-way clustered SEs, without small sample correction</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity</span>, vcov <span class="op">=</span> <span class="st">"twoway"</span>, ssc <span class="op">=</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; OLS estimation, Dep. Var.: log(Euros)</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Fixed-effects: Destination: 15,  Origin: 15,  Product: 20,  Year: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Destination &amp; Origin) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; log(dist_km) -2.16988   0.165494 -13.1115 2.9764e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 1.74337     Adj. R2: 0.705139</span></span>
<span><span class="co">#&gt;                 Within R2: 0.219322</span></span></code></pre>
<div class="section level3">
<h3 id="the-argument-vcov">The argument <code>vcov</code><a class="anchor" aria-label="anchor" href="#the-argument-vcov"></a>
</h3>
<p>The argument <code>vcov</code> can be equal to either:
<code>"iid"</code>, <code>"hetero"</code>, <code>"cluster"</code>,
<code>"twoway"</code>, <code>"NW"</code>, <code>"DK"</code>, or
<code>"conley"</code>.</p>
<p>If <code>vcov = "iid"</code>, then the standard-errors are based on
the assumption that the errors are non correlated and homoskedastic. If
<code>vcov = "hetero"</code>, this corresponds to the classic
hereoskedasticity-robust standard-errors (White correction), where it is
assumed that the errors are non correlated but the variance of their
generative law may vary.</p>
<p>If <code>vcov = "cluster"</code>, then arbitrary correlation of the
errors within clusters is accounted for. Same for
<code>vcov = "twoway"</code>: arbitrary correlation within each of the
two clusters is accounted for.</p>
<p>In the context of panel data or time series, <code>vcov = "NW"</code>
(Newey-West, 1987) or <code>vcov = "DK"</code> (Driscoll-Kraay, 1998)
account for temporal correlation between the errors; the two differing
on how to account for heterogeneity between units. Their implementation
is based on Millo (2017).</p>
<p>Finally, <code>vcov = "conley"</code> accounts for spatial
correlation of the errors.</p>
</div>
<div class="section level3">
<h3 id="the-argument-ssc">The argument <code>ssc</code><a class="anchor" aria-label="anchor" href="#the-argument-ssc"></a>
</h3>
<p>The type of small sample correction applied is defined by the
argument <code>ssc</code> which accepts only objects produced by the
function <code>ssc</code>. The main arguments of this function are
<code>adj</code>, <code>fixef.K</code> and <code>cluster.adj</code>. I
detail each of them below.</p>
<p>Say you have <span class="math inline">\(\tilde{V}\)</span> the
variance-covariance matrix (henceforth VCOV) before any small sample
adjustment. Argument <code>adj</code> can be equal to <code>TRUE</code>
or <code>FALSE</code>, leading to the following adjustment:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/adj.png?raw=true"></p>
<p>When the estimation contains fixed-effects, the value of <span class="math inline">\(K\)</span> in the previous adjustment can be
determined in different ways, governed by the argument
<code>fixef.K</code>. To illustrate how <span class="math inline">\(K\)</span> is computed, let’s use an example with
individual (variable <code>id</code>) and time fixed-effect and with
clustered standard-errors. The structure of the 10 observations data
is:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/sample_data.png?raw=true"></p>
<p>The standard-errors are clustered with respect to the
<code>cluster</code> variable, further we can see that the variable
<code>id</code> is nested within the <code>cluster</code> variable
(i.e. each value of <code>id</code> “belongs” to only one value of
<code>cluster</code>; e.g. <code>id</code> could represent US counties
and <code>cluster</code> US states).</p>
<p>The argument <code>fixef.K</code> can be equal to either
<code>"none"</code>, <code>"nested"</code> or <code>"full"</code>. Then
<span class="math inline">\(K\)</span> will be computed as follows:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/K_computation.png?raw=true"></p>
<p>Where <span class="math inline">\(K_{vars}\)</span> is the number of
estimated coefficients associated to the variables.
<code>fixef.K="none"</code> discards all fixed-effects coefficients.
<code>fixef.K="nested"</code> discards all coefficients that are nested
(here the 5 coefficients from <code>id</code>). Finally
<code>fixef.K="full"</code> accounts for all fixed-effects coefficients
(here 6: equal to 5 from <code>id</code>, plus 2 from <code>time</code>,
minus one used as a reference [otherwise collinearity arise]). Note that
if <code>fixef.K="nested"</code> and the standard-errors are
<em>not</em> clustered, this is equivalent to using
<code>fixef.K="full".</code></p>
<p>The last argument of <code>ssc</code> is <code>cluster.adj</code>.
This argument is only relevant when the standard-errors are clustered or
when they are corrected for serial correlation (Newey-West or
Driscoll-Kraay). Let <span class="math inline">\(M\)</span> be the
sandwich estimator of the VCOV without adjustment. Then for one-way
clustered standard errors:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/cluster_adj_one_way.png?raw=true"></p>
<p>With <span class="math inline">\(G\)</span> the number of unique
elements of the cluster variable (in the previous example <span class="math inline">\(G=2\)</span> for <code>cluster</code>).</p>
<p>The effect of the adjustment for two-way clustered standard-errors is
as follows:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/cluster_adj_two_way.png?raw=true"></p>
<p>Using the data from the previous example, here the standard-errors
are clustered by <code>id</code> and <code>time</code>, leading to <span class="math inline">\(G_{id}=5\)</span>, <span class="math inline">\(G_{time}=2\)</span>, and <span class="math inline">\(G_{id,time}=10\)</span>.</p>
<p>When standard-errors are corrected for serial correlation, the
corresponding adjustment applied is <span class="math inline">\(G_{time}
/ (G_{time} - 1)\)</span>.</p>
<div class="section level4">
<h4 id="yet-more-details">Yet more details<a class="anchor" aria-label="anchor" href="#yet-more-details"></a>
</h4>
<p>You’re already fed up about about these details? I’m sorry but
there’s more, so far you’ve only seen the main arguments! I now come to
detail three more elements: <code>fixef.force_exact</code>,
<code>cluster.df</code> and <code>t.df</code>.</p>
<p>Argument <code>fixef.force_exact</code> is only relevant when there
are two or more fixed-effects. By default all the fixed-effects
coefficients are accounted for when computing the degrees of freedom. In
general this is fine, but in some situations it may overestimate the
number of estimated coefficients. Why? Because some of the fixed-effects
may be collinear, the effective number of coefficients being lower.
Let’s illustrate that with an example. Consider the following set of
fixed-effects:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/exact_collinearity.png?raw=true"></p>
<p>There are 6 different values of <code>id</code> and 4 different
values of <code>time</code>. By default, 9 coefficients are used to
compute the degrees of freedom (6 plus 4 minus one reference). But we
can see here that the “effective” number of coefficients is equal to 8:
two coefficients should be removed to avoid collinearity issues (any one
from each color set). If you use <code>fixef.force_exact=TRUE</code>,
then the function <code>fixef</code> is first run to determine the
number of free coefficients in the fixed-effects, this number is then
used to compute the degree of freedom.</p>
<p>Argument <code>cluster.df</code> is only relevant when you apply
two-way clustering (or higher). It can have two values: either
<code>"conventional"</code>, or <code>"min"</code> (the default). This
affects the adjustments for each clustered matrix. The
<code>"conventional"</code> way to make the adjustment has already been
described in the previous equation. If <code>cluster.df="min"</code>
(again, the default), and for two-way clustered standard errors, the
adjustment becomes:</p>
<p><img src="https://github.com/lrberge/fixest/blob/master/vignettes/images/SE/cluster_df_min.png?raw=true"></p>
<p>Now instead of having a specific adjustment for each matrix, there is
only one adjustment of <span class="math inline">\(G_{min}/(G_{min}-1)\)</span> where <span class="math inline">\(G_{min}\)</span> is the minimum cluster size (here
<span class="math inline">\(G_{min}=\min(G_{id},G_{time})\)</span>).</p>
<p>Argument <code>t.df</code> is only relevant when standard-errors are
clustered. It affects the way the <em>p-value</em> and <em>confidence
intervals</em> are computed. It can be equal to: either
<code>"conventional"</code>, or <code>"min"</code> (the default). By
default, when standard-errors are clustered, the degrees of freedom used
in the Student t distribution is equal to the minimum cluster size
(among all clusters used to cluster the VCOV) minus one. If
<code>t.df="conventional"</code>, the degrees of freedom used to find
the p-value from the Student t distribution is equal to the number of
observations minus the number of estimated coefficients.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="replicating-standard-errors-from-other-methods">Replicating standard-errors from other methods<a class="anchor" aria-label="anchor" href="#replicating-standard-errors-from-other-methods"></a>
</h2>
<p>This section illustrates how the results from <code>fixest</code>
compares with the ones from other methods. It also shows how to
replicate the latter from <code>fixest</code>.</p>
<div class="section level4">
<h4 id="the-data-set-and-heteroskedasticity-robust-ses">The data set and heteroskedasticity-robust SEs<a class="anchor" aria-label="anchor" href="#the-data-set-and-heteroskedasticity-robust-ses"></a>
</h4>
<p>Using the Grunfeld data set from the <code>plm</code> package, here
are some comparisons when the estimation doesn’t contain
fixed-effects.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/" class="external-link">sandwich</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=plm" class="external-link">plm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Grunfeld</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimations</span></span>
<span><span class="va">res_lm</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span>, <span class="va">Grunfeld</span><span class="op">)</span></span>
<span><span class="va">res_feols</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span>, <span class="va">Grunfeld</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same standard-errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">res_lm</span><span class="op">)</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">res_feols</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      (Intercept)   capital</span></span>
<span><span class="co">#&gt; [1,]    15.63927 0.0383394</span></span>
<span><span class="co">#&gt; [2,]    15.63927 0.0383394</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Heteroskedasticity-robust covariance</span></span>
<span><span class="va">se_lm_hc</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a></span><span class="op">(</span><span class="va">res_lm</span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">se_feols_hc</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">res_feols</span>, vcov <span class="op">=</span> <span class="st">"hetero"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_lm_hc</span>, <span class="va">se_feols_hc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;             (Intercept)    capital</span></span>
<span><span class="co">#&gt; se_lm_hc       17.05558 0.06633144</span></span>
<span><span class="co">#&gt; se_feols_hc    17.05558 0.06633144</span></span></code></pre>
<p>Note that Stata’s <code>reg inv capital, robust</code> also leads to
similar results (same SEs, same p-values).</p>
</div>
<div class="section level4">
<h4 id="iid-ses-in-the-presence-of-fixed-effects">“IID” SEs in the presence of fixed-effects<a class="anchor" aria-label="anchor" href="#iid-ses-in-the-presence-of-fixed-effects"></a>
</h4>
<p>The most important differences arise in the presence of
fixed-effects. Let’s first compare “iid” standard-errors between
<code>lm</code> and <code>plm</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimations</span></span>
<span><span class="va">est_lm</span>    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">firm</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">Grunfeld</span><span class="op">)</span></span>
<span><span class="va">est_plm</span>   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plm/man/plm.html" class="external-link">plm</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">Grunfeld</span>, index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"firm"</span>, <span class="st">"year"</span><span class="op">)</span>, model <span class="op">=</span> <span class="st">"within"</span><span class="op">)</span></span>
<span><span class="co"># we use panel.id so that panel VCOVs can be applied directly</span></span>
<span><span class="va">est_feols</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">|</span> <span class="va">firm</span> <span class="op">+</span> <span class="va">year</span>, <span class="va">Grunfeld</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">firm</span> <span class="op">+</span> <span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="co"># "iid" standard-errors</span></span>
<span><span class="co">#</span></span>
<span></span>
<span><span class="co"># By default fixest clusters the SEs when FEs are present,</span></span>
<span><span class="co">#  so we need to ask for iid SEs explicitly.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_lm</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_plm</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;         capital</span></span>
<span><span class="co">#&gt; [1,] 0.02597821</span></span>
<span><span class="co">#&gt; [2,] 0.02597821</span></span>
<span><span class="co">#&gt; [3,] 0.02597821</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># p-values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_lm</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_plm</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span>, <span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           capital</span></span>
<span><span class="co">#&gt; [1,] 1.519204e-35</span></span>
<span><span class="co">#&gt; [2,] 1.519204e-35</span></span>
<span><span class="co">#&gt; [3,] 1.519204e-35</span></span></code></pre>
<p>The standard-errors and p-values are identical, note that this is
also the case for Stata’s <code>xtreg</code>.</p>
</div>
<div class="section level4">
<h4 id="clustered-ses">Clustered SEs<a class="anchor" aria-label="anchor" href="#clustered-ses"></a>
</h4>
<p>Now for clustered SEs:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Clustered by firm</span></span>
<span><span class="va">se_lm_firm</span>    <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovCL.html" class="external-link">vcovCL</a></span><span class="op">(</span><span class="va">est_lm</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">firm</span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span></span>
<span><span class="va">se_plm_firm</span>   <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a></span><span class="op">(</span><span class="va">est_plm</span>, cluster <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span></span>
<span><span class="va">se_stata_firm</span> <span class="op">=</span> <span class="fl">0.06328129</span>    <span class="co"># vce(cluster firm)</span></span>
<span><span class="va">se_feols_firm</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span><span class="op">)</span> <span class="co"># By default: clustered according to firm</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_lm_firm</span>, <span class="va">se_plm_firm</span>, <span class="va">se_stata_firm</span>, <span class="va">se_feols_firm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  capital</span></span>
<span><span class="co">#&gt; se_lm_firm    0.06493478</span></span>
<span><span class="co">#&gt; se_plm_firm   0.05693726</span></span>
<span><span class="co">#&gt; se_stata_firm 0.06328129</span></span>
<span><span class="co">#&gt; se_feols_firm 0.06328129</span></span></code></pre>
<p>As we can see, there are three different versions of the
standard-errors, <code>feols</code> being identical to Stata’s
<code>xtreg</code> clustered SEs. By default, the <em>p-value</em> is
also identical to the one from Stata (from <code>fixest</code> version
0.7.0 onwards).</p>
<p>Now let’s see how to replicate the standard-errors from
<code>lm</code> and <code>plm</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How to get the lm version</span></span>
<span><span class="va">se_feols_firm_lm</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, ssc <span class="op">=</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>fixef.K <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_lm_firm</span>, <span class="va">se_feols_firm_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                     capital</span></span>
<span><span class="co">#&gt; se_lm_firm       0.06493478</span></span>
<span><span class="co">#&gt; se_feols_firm_lm 0.06493478</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How to get the plm version</span></span>
<span><span class="va">se_feols_firm_plm</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, ssc <span class="op">=</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>fixef.K <span class="op">=</span> <span class="st">"none"</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_plm_firm</span>, <span class="va">se_feols_firm_plm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                      capital</span></span>
<span><span class="co">#&gt; se_plm_firm       0.05693726</span></span>
<span><span class="co">#&gt; se_feols_firm_plm 0.05693726</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="hac-ses">HAC SEs<a class="anchor" aria-label="anchor" href="#hac-ses"></a>
</h4>
<p>And finally let’s look at Newey-West and Driscoll-Kray
standard-errors:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># Newey-west</span></span>
<span><span class="co">#</span></span>
<span></span>
<span><span class="va">se_plm_NW</span>   <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/vcovNW.html" class="external-link">vcovNW</a></span><span class="op">(</span><span class="va">est_plm</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span></span>
<span><span class="va">se_feols_NW</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="st">"NW"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_plm_NW</span>, <span class="va">se_feols_NW</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                capital</span></span>
<span><span class="co">#&gt; se_plm_NW   0.08390222</span></span>
<span><span class="co">#&gt; se_feols_NW 0.08629896</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we can replicate plm's by changing the type of SSC:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_plm_NW</span>, </span>
<span>      <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="va">NW</span> <span class="op">~</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              capital</span></span>
<span><span class="co">#&gt; se_plm_NW 0.08390222</span></span>
<span><span class="co">#&gt;           0.08390222</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="co"># Driscoll-Kraay</span></span>
<span><span class="co">#</span></span>
<span></span>
<span><span class="va">se_plm_DK</span>   <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plm/man/vcovSCC.html" class="external-link">vcovSCC</a></span><span class="op">(</span><span class="va">est_plm</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span></span>
<span><span class="va">se_feols_DK</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="st">"DK"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_plm_DK</span>, <span class="va">se_feols_DK</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                capital</span></span>
<span><span class="co">#&gt; se_plm_DK   0.08359734</span></span>
<span><span class="co">#&gt; se_feols_DK 0.08800884</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Replicating plm's</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_plm_DK</span>, </span>
<span>      <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="va">DK</span> <span class="op">~</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;              capital</span></span>
<span><span class="co">#&gt; se_plm_DK 0.08359734</span></span>
<span><span class="co">#&gt;           0.08359734</span></span></code></pre>
<p>As we can see, the type of small sample correction we choose can have
a non-negligible impact on the standard-error.</p>
</div>
<div class="section level4">
<h4 id="other-multiple-fixed-effects-methods">Other multiple fixed-effects methods<a class="anchor" aria-label="anchor" href="#other-multiple-fixed-effects-methods"></a>
</h4>
<p>Now a specific comparison with <code>lfe</code> (version 2.8-7) and
Stata’s <code>reghdfe</code> which are popular tools to estimate
econometric models with multiple fixed-effects.</p>
<p>From <code>fixest</code> version 0.7.0 onwards, the standard-errors
and p-values are computed similarly to <code>reghdfe</code>, for both
clustered and multiway clustered standard errors. So the comparison here
focuses on <code>lfe</code>.</p>
<p>Here are the differences and similarities with <code>lfe</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MatthieuStigler/lfe" class="external-link">lfe</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># lfe: clustered by firm</span></span>
<span><span class="va">est_lfe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">|</span> <span class="va">firm</span> <span class="op">+</span> <span class="va">year</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">firm</span>, <span class="va">Grunfeld</span><span class="op">)</span></span>
<span><span class="va">se_lfe_firm</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_lfe</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The two are different, and it cannot be directly replicated by feols</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_lfe_firm</span>, <span class="va">se_feols_firm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  capital</span></span>
<span><span class="co">#&gt; se_lfe_firm   0.06016851</span></span>
<span><span class="co">#&gt; se_feols_firm 0.06328129</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You have to provide a custom VCOV to replicate lfe's VCOV</span></span>
<span><span class="va">my_vcov</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">est_feols</span>, ssc <span class="op">=</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="va">my_vcov</span> <span class="op">*</span> <span class="fl">199</span><span class="op">/</span><span class="fl">198</span><span class="op">)</span> <span class="co"># Note that there are 200 observations</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;    capital </span></span>
<span><span class="co">#&gt; 0.06016851</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Differently from feols, the SEs in lfe are different if year is not a FE:</span></span>
<span><span class="co"># =&gt; now SEs are identical.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|</span> <span class="va">firm</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">firm</span>, <span class="va">Grunfeld</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span>,</span>
<span>      <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|</span> <span class="va">firm</span>, <span class="va">Grunfeld</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"capital"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;         capital</span></span>
<span><span class="co">#&gt; [1,] 0.06328129</span></span>
<span><span class="co">#&gt; [2,] 0.06328129</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now with two-way clustered standard-errors</span></span>
<span><span class="va">est_lfe_2way</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span><span class="va">inv</span> <span class="op">~</span> <span class="va">capital</span> <span class="op">|</span> <span class="va">firm</span> <span class="op">+</span> <span class="va">year</span> <span class="op">|</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">firm</span> <span class="op">+</span> <span class="va">year</span>, <span class="va">Grunfeld</span><span class="op">)</span></span>
<span><span class="va">se_lfe_2way</span>   <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_lfe_2way</span><span class="op">)</span></span>
<span><span class="va">se_feols_2way</span> <span class="op">=</span> <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_lfe_2way</span>, <span class="va">se_feols_2way</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                  capital</span></span>
<span><span class="co">#&gt; se_lfe_2way   0.06213837</span></span>
<span><span class="co">#&gt; se_feols_2way 0.06041290</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To obtain the same SEs, use cluster.df = "conventional"</span></span>
<span><span class="va">sum_feols_2way_conv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_feols</span>, vcov <span class="op">=</span> <span class="va">twoway</span> <span class="op">~</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>cluster.df <span class="op">=</span> <span class="st">"conv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">se_lfe_2way</span>, <span class="fu"><a href="../reference/coeftable.html">se</a></span><span class="op">(</span><span class="va">sum_feols_2way_conv</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;                capital</span></span>
<span><span class="co">#&gt; se_lfe_2way 0.06213837</span></span>
<span><span class="co">#&gt;             0.06213837</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We also obtain the same p-values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">est_lfe_2way</span><span class="op">)</span>, <span class="fu"><a href="../reference/coeftable.html">pvalue</a></span><span class="op">(</span><span class="va">sum_feols_2way_conv</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           capital</span></span>
<span><span class="co">#&gt; [1,] 9.273982e-05</span></span>
<span><span class="co">#&gt; [2,] 9.273982e-05</span></span></code></pre>
<p>As we can see, there is only slight differences with <code>lfe</code>
when computing clustered standard-errors. For multiway clustered
standard-errors, it is easy to replicate the way <code>lfe</code>
computes them.</p>
</div>
<div class="section level4">
<h4 id="defining-how-to-compute-the-standard-errors-once-and-for-all">Defining how to compute the standard-errors once and for all<a class="anchor" aria-label="anchor" href="#defining-how-to-compute-the-standard-errors-once-and-for-all"></a>
</h4>
<p>Once you’ve found the preferred way to compute the standard-errors
for your current project, you can set it permanently using the functions
<code><a href="../reference/ssc.html">setFixest_ssc()</a></code> and <code><a href="../reference/setFixest_vcov.html">setFixest_vcov()</a></code>.</p>
<p>For example, if you want to remove the small sample adjustment, just
use:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ssc.html">setFixest_ssc</a></span><span class="op">(</span><span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By default, the standard-errors are clustered in the presence of
fixed-effects and in the presence of a panel. You can change this
behavior with, e.g.:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setFixest_vcov.html">setFixest_vcov</a></span><span class="op">(</span>no_FE <span class="op">=</span> <span class="st">"iid"</span>, one_FE <span class="op">=</span> <span class="st">"iid"</span>, </span>
<span>               two_FE <span class="op">=</span> <span class="st">"hetero"</span>, panel <span class="op">=</span> <span class="st">"driscoll_kraay"</span><span class="op">)</span></span></code></pre></div>
<p>which changes the way the default standard-errors are computed when
the estimation contains no fixed-effects, one fixed-effect, two or more
fixed-effects, or is a panel.</p>
</div>
</div>
<div class="section level2">
<h2 id="changelog">Changelog<a class="anchor" aria-label="anchor" href="#changelog"></a>
</h2>
<ul>
<li>
<p>Version 0.10.0 brings about many important changes:</p>
<ul>
<li><p>The arguments <code>se</code> and <code>cluster</code> have been
replaced by the argument <code>vcov</code>. Retro compatibility is
ensured.</p></li>
<li><p>The argument <code>dof</code> has been renamed to
<code>ssc</code> for clarity (since it was dealing with small sample
correction). This is <em>not</em> retro compatible.</p></li>
<li><p>Three new types of standard-errors are added: Newey-West and
Driscoll-Kraay for panel data; Conley to account for spatial
correlation.</p></li>
<li><p>The argument <code>ssc</code> can now be directly summoned in the
<code>vcov</code> formula.</p></li>
<li><p>The functions <code>setFixest_dof</code> and
<code>setFixest_se</code> have been renamed into
<code>setFixest_ssc</code> and <code>setFixest_vcov</code>. Retro
compatibility is <em>not</em> ensured.</p></li>
<li><p>The default standard-error name has changed from
<code>"standard"</code> to <code>"iid"</code> (thanks to Grant McDermott
for the suggestion!).</p></li>
<li><p>Since <code>lfe</code> has returned to CRAN (good news!), the
code chunks involving it are now re-evaluated.</p></li>
<li><p>The illustration is now based on the Grunfeld data set from the
<code>plm</code> package (to avoid problems with RNG).</p></li>
</ul>
</li>
<li><p>Version 0.8.0. Evaluation of the chunks related to
<code>lfe</code> have been removed since its archival on the CRAN. Hard
values from the last CRAN version are maintained.</p></li>
<li>
<p>Version 0.7.0 introduces the following important
modifications:</p>
<ul>
<li><p>To increase clarity, <code>se = "white"</code> becomes
<code>se = "hetero"</code>. Retro-compatibility is ensured.</p></li>
<li><p>The default values for computing clustered standard-errors become
similar to <code>reghdfe</code> to avoid cross-software confusion. That
is, now by default <code>cluster.df = "min"</code> and
<code>t.df = "min"</code> (whereas in the previous version it was
<code>cluster.df = "conventional"</code> and
<code>t.df = "conventional"</code>).</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="references-acknowledgments">References &amp; acknowledgments<a class="anchor" aria-label="anchor" href="#references-acknowledgments"></a>
</h2>
<p>I wish to thank Karl Dunkle Werner, Grant McDermott and Ivo Welch for
raising the issue and for helpful discussions. Any error is of course my
own.</p>
<p>Cameron AC, Gelbach JB, Miller DL (2011). “<a href="https://www.nber.org/papers/t0327" class="external-link">Robust Inference with Multiway
Clustering</a>”, Journal of Business &amp; Ecomomic Statistics, 29(2),
238–249.</p>
<p>Kauermann G, Carroll RJ (2001). “<a href="https://www.tandfonline.com/doi/abs/10.1198/016214501753382309" class="external-link">A
Note on the Efficiency of Sandwich Covariance Matrix Estimation</a>”,
Journal of the American Statistical Association, 96(456), 1387–1396.</p>
<p>MacKinnon JG, White H (1985). “Some heteroskedasticity-consistent
covariance matrix estimators with improved finite sample properties”
Journal of Econometrics, 29(3), 305–325.</p>
<p>Millo G (2017). “<a href="https://doi.org/10.18637/jss.v082.i03" class="external-link">Robust Standard Error
Estimators for Panel Models: A Unifying Approach</a>” Journal of
Statistical Software, 82(3).</p>
<p>Zeileis A, Koll S, Graham N (2020). “<a href="https://cran.r-project.org/package=sandwich/vignettes/sandwich-CL.pdf" class="external-link">Various
Versatile Variances: An Object-Oriented Implementation of Clustered
Covariances in R</a>” Journal of Statistical Software, 95(1), 1–36.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
