<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fixest">
<title>Fast Fixed-Effects Estimation: Short Introduction • fixest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fast Fixed-Effects Estimation: Short Introduction">
<meta property="og:description" content="fixest">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fixest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.11.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fixest_walkthrough.html">Fast Fixed-Effects Estimation: Short Introduction</a>
    <a class="dropdown-item" href="../articles/multiple_estimations.html">Multiple estimations</a>
    <a class="dropdown-item" href="../articles/standard_errors.html">On standard-errors</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Estimation tables</h6>
    <a class="dropdown-item" href="../articles/exporting_tables.html">Exporting estimation tables</a>
    <a class="dropdown-item" href="../articles/etable_new_features.html">`etable`: new features in `fixest` 0.10.2</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lrberge/fixest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fast Fixed-Effects Estimation: Short Introduction</h1>
                        <h4 data-toc-skip class="author">Laurent Berge
and Grant McDermott</h4>
            
            <h4 data-toc-skip class="date">2023-09-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrberge/fixest/blob/HEAD/vignettes/fixest_walkthrough.Rmd" class="external-link"><code>vignettes/fixest_walkthrough.Rmd</code></a></small>
      <div class="d-none name"><code>fixest_walkthrough.Rmd</code></div>
    </div>

    
    
<!-- Help on vignette writing here: http://r-pkgs.had.co.nz/vignettes.html. -->
<p>The package <code>fixest</code> provides a family of functions to
perform estimations with multiple fixed-effects. The two main functions
are <code>feols</code> for linear models and <code>feglm</code> for
generalized linear models. In addition, the function <code>femlm</code>
performs direct maximum likelihood estimation, and <code>feNmlm</code>
extends the latter to allow the inclusion of non-linear in parameters
right-hand-sides. Finally, the functions <code>fepois</code> and
<code>fenegbin</code> are aliases for Poisson and negative binomial
fixed-effect estimations. Each of these functions supports any number of
fixed-effects and is implemented with full fledged multi-threading in
C++. Functions <code>feols</code> and <code>feglm</code> further support
variables with varying slopes.</p>
<p>This package is currently (Feb. 2020) the fastest software available
to perform fixed-effects estimations. See the project’s <a href="https://lrberge.github.io/fixest/">homepage</a> for a set of
benchmarks.</p>
<p>The standard-errors of the estimates can be easily and intuitively
clustered (up to four-way).</p>
<p>The function <code>etable</code> allows to seamlessly export the
results of multiple estimations into either a data.frame, or into a
Latex table.</p>
<p>The main features of the package are illustrated in this vignette.
The theory used to obtain the fixed-effects is based on <a href="https://wwwen.uni.lu/content/download/110162/1299525/file/2018_13" class="external-link">Berge
(2018)</a>, “<em>Efficient estimation of maximum likelihood models with
multiple fixed-effects: the R package FENmlm.</em>” CREA Discussion
Papers, 13.</p>
<div class="section level2">
<h2 id="simple-example-using-trade-data">Simple example using trade data<a class="anchor" aria-label="anchor" href="#simple-example-using-trade-data"></a>
</h2>
<p>This example deals with international trade, which is a setup that
usually requires performing estimations with many fixed-effects. We
estimate a very simple gravity model in which we are interested in
finding out the negative effect of geographic distance on trade. The
sample data consists of European trade extracted from Eurostat. Let’s
load the data contained in the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trade</span><span class="op">)</span></span></code></pre></div>
<p>This data is a sample of bilateral importations between EU15
countries from 2007 and 2016. The data is further broken down according
to 20 product categories. Here is a sample of the data:</p>
<table class="table">
<thead><tr class="header">
<th align="left">Destination</th>
<th align="left">Origin</th>
<th align="right">Product</th>
<th align="right">Year</th>
<th align="right">dist_km</th>
<th align="right">Euros</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">1</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">2966697</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">1</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">6755030</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">2</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">57078782</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">2</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">7117406</td>
</tr>
<tr class="odd">
<td align="left">LU</td>
<td align="left">BE</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">17379821</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">LU</td>
<td align="right">3</td>
<td align="right">2007</td>
<td align="right">139.5719</td>
<td align="right">2622254</td>
</tr>
</tbody>
</table>
<p>The dependent variable of the estimation will be the level of trade
between two countries while the independent variable is the geographic
distance between the two countries. To obtain the elasticity of
geographic distance net of the effects of the four fixed-effects, we
estimate the following:</p>
<p><span class="math inline">\(E\left(Trade_{i,j,p,t}\right)=\gamma_{i}^{Exporter}\times\gamma_{j}^{Importer}\times\gamma_{p}^{Product}\times\gamma_{t}^{Year}\times
Distance_{ij}^{\beta}\)</span>,</p>
<p>where the subscripts <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span>, <span class="math inline">\(p\)</span>
and <span class="math inline">\(t\)</span> stand respectively for the
exporting country, the importing country, the type of product and the
year, and the <span class="math inline">\(\gamma_{v}^{c}\)</span> are
fixed-effects for these groups. Here <span class="math inline">\(\beta\)</span> is the elasticity of interest.</p>
<p>Note that when you use the Poisson/Negative Binomial families, this
relationship is in fact linear because the right hand side is
exponentialized to avoid negative values for the Poisson parameter. This
leads to the equivalent relation:<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Since the &lt;span class="math inline"&gt;\(\gamma\)&lt;/span&gt;
are parameters, I omit to put them in logarithmic form.&lt;/p&gt;'><sup>1</sup></a></p>
<p><span class="math inline">\(E\left(Trade_{i,j,p,t}\right)=\exp\left(\gamma_{i}^{Exporter}+\gamma_{j}^{Importer}+\gamma_{p}^{Product}+\gamma_{t}^{Year}+\beta\times
\ln Distance_{ij}\right)\)</span>.</p>
<div class="section level3">
<h3 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h3>
<p>The estimation of this model using a Poisson likelihood is as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravity_pois</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>fepois</code> is actually an alias to the function
<code>feglm</code> with <code>family = poisson</code>. The results can
be shown directly with the <code>print</code> method:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">gravity_pois</span><span class="op">)</span></span>
<span><span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Origin) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; log(dist_km) -1.52787   0.115678 -13.208 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Log-Likelihood: -7.025e+11   Adj. Pseudo R2: 0.764032</span></span>
<span><span class="co">#&gt;            BIC:  1.405e+12     Squared Cor.: 0.612021</span></span></code></pre></div>
<p>The <code>print</code> reports the coefficient estimates and
standard-errors as well as some other information. Among the quality of
fit information, the squared-correlation corresponds to the correlation
between the dependent variable and the expected predictor; it reflects
somehow the idea of R-square in OLS estimations. Note that the
estimation is performed using parallel computing which you can control
using the argument <code>nthreads</code> (see the “multi-threading”
section for more details).</p>
</div>
<div class="section level3">
<h3 id="clustering-the-standard-errors">Clustering the standard-errors<a class="anchor" aria-label="anchor" href="#clustering-the-standard-errors"></a>
</h3>
<p>To cluster the standard-errors, we can simply use the argument
<code>vcov</code> of the <code>summary</code> method. Let’s say we want
to cluster the standard-errors according to the first two fixed-effects
(i.e. the <em>Origin</em> and <em>Destination</em> variables). Then we
just have to do:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, vcov <span class="op">=</span> <span class="st">"twoway"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Origin &amp; Destination) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; log(dist_km) -1.52787   0.130734 -11.6869 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Log-Likelihood: -7.025e+11   Adj. Pseudo R2: 0.764032</span></span>
<span><span class="co">#&gt;            BIC:  1.405e+12     Squared Cor.: 0.612021</span></span></code></pre></div>
<p>The clustering can be done on one, two, three or up to four
variables. If the estimation includes fixed-effects, then by default the
clustering will be done using these fixed-effects, in the original
order. This is why the <em>Origin</em> and <em>Destination</em>
variables were used for the two-way clustering in the previous example.
If, instead, you wanted to perform one-way clustering on the
<em>Product</em> variable, you need to provide it in a formula or use
the argument <code>cluster</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Three ways to summon clustering on the Product variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="st">"Product"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span></span></code></pre></div>
<p>Both produce the same results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity_pois</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span></span>
<span><span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Fixed-effects: Origin: 15,  Destination: 15,  Product: 20,  Year: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Product) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; log(dist_km) -1.52787   0.098294 -15.544 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Log-Likelihood: -7.025e+11   Adj. Pseudo R2: 0.764032</span></span>
<span><span class="co">#&gt;            BIC:  1.405e+12     Squared Cor.: 0.612021</span></span></code></pre></div>
<p>Note that you can always cluster the standard-errors, even when the
estimation contained no fixed-effect:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravity_simple</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span>, <span class="va">trade</span><span class="op">)</span></span>
<span><span class="co"># We use a formula to specify the variables used for two way clustering</span></span>
<span><span class="co"># (note that the values of the variables are fetched directly in the original database)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gravity_simple</span>, <span class="op">~</span><span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span><span class="op">)</span></span>
<span><span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Origin &amp; Destination) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  24.70889   1.124768 21.96798  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; log(dist_km) -1.02896   0.158022 -6.51145 7.4429e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Log-Likelihood: -2.426e+12   Adj. Pseudo R2: 0.185023</span></span>
<span><span class="co">#&gt;            BIC:  4.852e+12     Squared Cor.: 0.055107</span></span></code></pre></div>
<p>Finally, the standard-errors can also be computed at estimation time,
you simply need to add the <code>vcov</code> argument:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span>, <span class="va">trade</span>, vcov <span class="op">=</span> <span class="op">~</span><span class="va">Product</span><span class="op">)</span></span>
<span><span class="co">#&gt; Poisson estimation, Dep. Var.: Euros</span></span>
<span><span class="co">#&gt; Observations: 38,325 </span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (Product) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  24.70889   0.330044  74.8654 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; log(dist_km) -1.02896   0.045954 -22.3909 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Log-Likelihood: -2.426e+12   Adj. Pseudo R2: 0.185023</span></span>
<span><span class="co">#&gt;            BIC:  4.852e+12     Squared Cor.: 0.055107</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-standard-errors">Other standard-errors<a class="anchor" aria-label="anchor" href="#other-standard-errors"></a>
</h3>
<p>Talking about standard-errors… there are more than clustered
standard-errors that can be computed… and there are many ways to achieve
the same thing… and many shortcuts to know. So before you leave don’t
forget to have a look at the section describing how to use the <a href="#the-vcov-argument">vcov argument</a>!</p>
</div>
<div class="section level3">
<h3 id="other-estimation-functions">Other estimation functions<a class="anchor" aria-label="anchor" href="#other-estimation-functions"></a>
</h3>
<p>Now we estimate the same relationship by OLS. We need to put the left
hand side in logarithm (since the right-hand-side is not
exponentialized):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravity_ols</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Euros</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></span></code></pre></div>
<p>Of course you can use different families in <code>feglm</code>,
exactly as in <code>glm</code>.</p>
<p>To get the estimation for the fixed-effects Negative Binomial:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravity_negbin</span> <span class="op">=</span> <span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="va">Origin</span> <span class="op">+</span> <span class="va">Destination</span> <span class="op">+</span> <span class="va">Product</span> <span class="op">+</span> <span class="va">Year</span>, <span class="va">trade</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="viewing-the-results-in-r">Viewing the results in R<a class="anchor" aria-label="anchor" href="#viewing-the-results-in-r"></a>
</h3>
<p>Now let’s say that we want a compact overview of the results of
several estimations. The best way is to use the function
<code>etable</code>. This function summarizes the results of several
<code>fixest</code> estimations into a data.frame. To see the
fixed-effects results with the three different likelihoods, we just have
to type:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">gravity_pois</span>, <span class="va">gravity_negbin</span>, <span class="va">gravity_ols</span>,</span>
<span>         vcov <span class="op">=</span> <span class="st">"twoway"</span>, headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Poisson"</span>, <span class="st">"Negative Binomial"</span>, <span class="st">"Gaussian"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="21%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left"></th>
<th align="left">gravity_pois</th>
<th align="left">gravity_negbin</th>
<th align="left">gravity_ols</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left"></td>
<td align="left">Poisson</td>
<td align="left">Negative Binomial</td>
<td align="left">Gaussian</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">4</td>
<td align="left">log(dist_km)</td>
<td align="left">-1.528*** (0.1307)</td>
<td align="left">-1.711*** (0.1773)</td>
<td align="left">-2.170*** (0.1714)</td>
</tr>
<tr class="even">
<td align="left">5</td>
<td align="left">Fixed-Effects:</td>
<td align="left">——————</td>
<td align="left">——————</td>
<td align="left">——————</td>
</tr>
<tr class="odd">
<td align="left">6</td>
<td align="left">Origin</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">Destination</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="left">Product</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">Year</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="left">_______________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
</tr>
<tr class="even">
<td align="left">11</td>
<td align="left">Family</td>
<td align="left">Poisson</td>
<td align="left">Neg. Bin.</td>
<td align="left">OLS</td>
</tr>
<tr class="odd">
<td align="left">12</td>
<td align="left">S.E.: Clustered</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
</tr>
<tr class="even">
<td align="left">13</td>
<td align="left">Observations</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
</tr>
<tr class="odd">
<td align="left">14</td>
<td align="left">Squared Cor.</td>
<td align="left">0.61202</td>
<td align="left">0.43760</td>
<td align="left">0.70558</td>
</tr>
<tr class="even">
<td align="left">15</td>
<td align="left">Pseudo R2</td>
<td align="left">0.76403</td>
<td align="left">0.03473</td>
<td align="left">0.23640</td>
</tr>
<tr class="odd">
<td align="left">16</td>
<td align="left">BIC</td>
<td align="left">1.4e+12</td>
<td align="left">1,293,786.1</td>
<td align="left">151,977.2</td>
</tr>
<tr class="even">
<td align="left">17</td>
<td align="left">Over-dispersion</td>
<td align="left">–</td>
<td align="left">0.54877</td>
<td align="left">–</td>
</tr>
</tbody>
</table>
<p>We added the argument <code>vcov="twoway"</code> to cluster the
standard-errors for all estimations. As can be seen this function gives
an overview of the estimates and standard-errors, as well as some
quality of fit measures. The argument <code>headers</code> is used to
add information on each estimation column.</p>
<p>In the previous example, we directly added the estimation results as
arguments of the function <code>etable</code>. But the function also
accepts lists of estimations. Let’s give an example. Say you want to see
the influence of the introduction of fixed-effects on the estimate of
the elasticity of distance. You can do it with the following code where
we use the argument <code>fixef</code> to include fixed-effects (instead
of inserting them directly in the formula):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gravity_subfe</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">all_FEs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Year"</span>, <span class="st">"Destination"</span>, <span class="st">"Origin"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">gravity_subfe</span><span class="op">[[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span>, <span class="va">trade</span>, fixef <span class="op">=</span> <span class="va">all_FEs</span><span class="op">[</span><span class="fl">0</span><span class="op">:</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The previous code performs 4 estimations with an increasing number of
fixed-effects and store their results into the list named
<code>gravity_subfe</code>. To show the results of all 4 estimations,
it’s easy:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">gravity_subfe</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="17%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">model 1</th>
<th align="left">model 2</th>
<th align="left">model 3</th>
<th align="left">model 4</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Dependent Var.:</td>
<td align="left">Euros</td>
<td align="left">Euros</td>
<td align="left">Euros</td>
<td align="left">Euros</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Constant</td>
<td align="left">24.71*** (1.125)</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">log(dist_km)</td>
<td align="left">-1.029*** (0.1580)</td>
<td align="left">-1.029*** (0.1581)</td>
<td align="left">-1.226*** (0.2045)</td>
<td align="left">-1.518*** (0.1282)</td>
</tr>
<tr class="odd">
<td align="left">Fixed-Effects:</td>
<td align="left">——————</td>
<td align="left">——————</td>
<td align="left">——————</td>
<td align="left">——————</td>
</tr>
<tr class="even">
<td align="left">Year</td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">Destination</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">Yes</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">Origin</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">_______________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
<td align="left">__________________</td>
</tr>
<tr class="even">
<td align="left">S.E.: Clustered</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
<td align="left">by: Orig. &amp; Dest.</td>
</tr>
<tr class="odd">
<td align="left">Observations</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
<td align="left">38,325</td>
</tr>
<tr class="even">
<td align="left">Squared Cor.</td>
<td align="left">0.05511</td>
<td align="left">0.05711</td>
<td align="left">0.16420</td>
<td align="left">0.38479</td>
</tr>
<tr class="odd">
<td align="left">Pseudo R2</td>
<td align="left">0.18502</td>
<td align="left">0.18833</td>
<td align="left">0.35826</td>
<td align="left">0.59312</td>
</tr>
<tr class="even">
<td align="left">BIC</td>
<td align="left">4.85e+12</td>
<td align="left">4.83e+12</td>
<td align="left">3.82e+12</td>
<td align="left">2.42e+12</td>
</tr>
</tbody>
</table>
<p>We have a view of the 4 estimations, all reporting two-way clustered
standard-errors thanks to the use of the argument
<code>cluster</code>.</p>
</div>
<div class="section level3">
<h3 id="multiple-estimations">Multiple estimations<a class="anchor" aria-label="anchor" href="#multiple-estimations"></a>
</h3>
<p>Note that since version 0.8.0, multiple estimations can be performed
at once without requiring loops. Let’s replicate the previous example
using <code>fixest</code> stepwise functions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_multi</span> <span class="op">=</span> <span class="fu"><a href="../reference/feglm.html">fepois</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="../reference/stepwise.html">csw0</a></span><span class="op">(</span><span class="va">Year</span>, <span class="va">Destination</span>, <span class="va">Origin</span><span class="op">)</span>, <span class="va">trade</span><span class="op">)</span></span></code></pre></div>
<p>The previous line of code performs 4 estimations. The function
<code>csw0</code> is the key here, it means: <em>cumulative stepwise
starting with the empty element</em>. Starting with the empty element,
each new estimation adds a new element in the <code><a href="../reference/stepwise.html">csw0()</a></code>
function, quite like the previous loop. Then you can consider the
results, here <code>res_multi</code>, as a list of results, although
with specific methods to easily access each element.</p>
<p>Stepwise functions can be applied to the linear right-hand-side and
to the fixed-effects, you can also have multiple dependent variables and
perform split sample estimations with the argument <code>split</code>.
All of this is detailed in the dedicated vignette: <a href="https://lrberge.github.io/fixest/articles/multiple_estimations.html">Multiple
estimations</a>.</p>
</div>
<div class="section level3">
<h3 id="exporting-the-results-to-latex">Exporting the results to Latex<a class="anchor" aria-label="anchor" href="#exporting-the-results-to-latex"></a>
</h3>
<p>So far we have seen how to report the results of multiple estimations
on the R console. Now, using the same function <code>etable</code>, we
can also export the results to high quality Latex tables. We just need
to provide the argument <code>tex = TRUE</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># with two-way clustered SEs</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_multi</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span>, tex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; \begingroup</span></span>
<span><span class="co">#&gt; \centering</span></span>
<span><span class="co">#&gt; \begin{tabular}{lcccc}</span></span>
<span><span class="co">#&gt;    \tabularnewline \midrule \midrule</span></span>
<span><span class="co">#&gt;    Dependent Variable: &amp; \multicolumn{4}{c}{Euros}\\</span></span>
<span><span class="co">#&gt;    Model:              &amp; (1)                   &amp; (2)                   &amp; (3)                   &amp; (4)\\  </span></span>
<span><span class="co">#&gt;    \midrule</span></span>
<span><span class="co">#&gt;    \emph{Variables}\\</span></span>
<span><span class="co">#&gt;    Constant            &amp; 24.71$^{***}$         &amp;                       &amp;                       &amp;   \\   </span></span>
<span><span class="co">#&gt;                        &amp; (1.125)               &amp;                       &amp;                       &amp;   \\   </span></span>
<span><span class="co">#&gt;    log(dist\_km)       &amp; -1.029$^{***}$        &amp; -1.029$^{***}$        &amp; -1.226$^{***}$        &amp; -1.518$^{***}$\\   </span></span>
<span><span class="co">#&gt;                        &amp; (0.1580)              &amp; (0.1581)              &amp; (0.2045)              &amp; (0.1282)\\   </span></span>
<span><span class="co">#&gt;    \midrule</span></span>
<span><span class="co">#&gt;    \emph{Fixed-effects}\\</span></span>
<span><span class="co">#&gt;    Year                &amp;                       &amp; Yes                   &amp; Yes                   &amp; Yes\\  </span></span>
<span><span class="co">#&gt;    Destination         &amp;                       &amp;                       &amp; Yes                   &amp; Yes\\  </span></span>
<span><span class="co">#&gt;    Origin              &amp;                       &amp;                       &amp;                       &amp; Yes\\  </span></span>
<span><span class="co">#&gt;    \midrule</span></span>
<span><span class="co">#&gt;    \emph{Fit statistics}\\</span></span>
<span><span class="co">#&gt;    Observations        &amp; 38,325                &amp; 38,325                &amp; 38,325                &amp; 38,325\\  </span></span>
<span><span class="co">#&gt;    Squared Correlation &amp; 0.05511               &amp; 0.05711               &amp; 0.16420               &amp; 0.38479\\  </span></span>
<span><span class="co">#&gt;    Pseudo R$^2$        &amp; 0.18502               &amp; 0.18833               &amp; 0.35826               &amp; 0.59312\\  </span></span>
<span><span class="co">#&gt;    BIC                 &amp; $4.85\times 10^{12}$  &amp; $4.83\times 10^{12}$  &amp; $3.82\times 10^{12}$  &amp; $2.42\times 10^{12}$\\   </span></span>
<span><span class="co">#&gt;    \midrule \midrule</span></span>
<span><span class="co">#&gt;    \multicolumn{5}{l}{\emph{Clustered (Origin \&amp; Destination) standard-errors in parentheses}}\\</span></span>
<span><span class="co">#&gt;    \multicolumn{5}{l}{\emph{Signif. Codes: ***: 0.01, **: 0.05, *: 0.1}}\\</span></span>
<span><span class="co">#&gt; \end{tabular}</span></span>
<span><span class="co">#&gt; \par\endgroup</span></span></code></pre></div>
<p>The user can export the Latex table directly into a file (argument
<code>file</code>), add a title (arg. <code>title</code>) and a label to
the table (arg. <code>label</code>). Note that when the argument
<code>file</code> is present, the Latex format becomes the default
(i.e. <code>tex = TRUE</code> by default).</p>
<p>The coefficients can be renamed easily (arg. <code>dict</code>), some
can be dropped (arg. <code>drop</code>) and they can be easily reordered
with regular expressions (arg. <code>order</code>).</p>
<p>The significance codes can easily be changed (arg.
<code>signifCode</code>) and all quality of fit information can be
customized (argument <code>fitstat</code>). Among others, the number of
fixed-effect per fixed-effect dimension can also be displayed using the
argument <code>fixef_sizes</code>.</p>
<div class="section level4">
<h4 id="an-elaborate-example">An elaborate example<a class="anchor" aria-label="anchor" href="#an-elaborate-example"></a>
</h4>
<p>Consider the following example of the exportation of two tables:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we set the dictionary once and for all</span></span>
<span><span class="va">myDict</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log(dist_km)"</span> <span class="op">=</span> <span class="st">"$\\ln (Distance)$"</span>, <span class="st">"(Intercept)"</span> <span class="op">=</span> <span class="st">"Constant"</span><span class="op">)</span></span>
<span><span class="co"># 1st export: we change the signif code and drop the intercept</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_multi</span>, signifCode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span> <span class="op">=</span> <span class="fl">0.01</span>, <span class="st">"b"</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>       drop <span class="op">=</span> <span class="st">"Const"</span>, dict <span class="op">=</span> <span class="va">myDict</span>, file <span class="op">=</span> <span class="st">"Estimation Tables.tex"</span>, </span>
<span>       replace <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"First export -- normal Standard-errors"</span><span class="op">)</span></span>
<span><span class="co"># 2nd export: clustered S-E + distance as the first coefficient</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_multi</span>, cluster <span class="op">=</span> <span class="op">~</span><span class="va">Product</span>, order <span class="op">=</span> <span class="st">"Dist"</span>, </span>
<span>       dict <span class="op">=</span> <span class="va">myDict</span>, file <span class="op">=</span> <span class="st">"Estimation Tables.tex"</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Second export -- clustered standard-errors (on Product variable)"</span><span class="op">)</span></span></code></pre></div>
<p>In this example, two tables containing the results of the 4
estimations are directly exported to a Latex table into the file
“Estimation Tables.tex”. First take notice (again) that <em>we do not
need to use the argument</em> <code>tex=TRUE</code> since when the
argument <code>file</code> is present, the Latex format becomes the
default. The file is re-created in the first exportation thanks to the
argument <code>replace = TRUE</code>.</p>
<p>To change the variable names in the Latex table, we use the argument
<code>dict</code>. The variable <code>myDict</code> is the dictionary we
use to rename the variables, it is simply a named vector. The original
name of the variables correspond to the names of <code>myDict</code>
while the new names of the variables are the values of this vector. Any
variable that matches the names of <code>myDict</code> will be replaced
by its value. Thus we do not care of the order of appearance of the
variables in the estimation results.</p>
<p>In the first export, the coefficient of the intercept is dropped by
using <code>drop = "Const"</code> (could be anything such that
<code>grepl(drop[1], "Constant")</code> is TRUE). In the second, the
coefficient of the distance is put before the intercept (which is kept)
thanks to the argument <code>order</code>. Note that the actions
performed by the arguments <code>drop</code> or <code>order</code> are
performed <strong>after</strong> the renaming takes place with the
argument <code>dict</code>.</p>
<p>Note that you can completely customize the style of the table by
using the <code>style</code> and <code>postprocessing</code> arguments,
please have a look at the dedicated vignette: <a href="https://lrberge.github.io/fixest/articles/exporting_tables.html">Exporting
estimation tables</a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="extracting-the-fixed-effects-coefficients">Extracting the fixed-effects coefficients<a class="anchor" aria-label="anchor" href="#extracting-the-fixed-effects-coefficients"></a>
</h3>
<p>To obtain the fixed-effects of the estimation, the function
<code>fixef</code> must be performed on the results. This function
returns a list containing the fixed-effects coefficients for each
dimension. The <code>summary</code> method helps to have a quick
overview:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixedEffects</span> <span class="op">=</span> <span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">gravity_pois</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fixedEffects</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fixed_effects coefficients</span></span>
<span><span class="co">#&gt;                         Origin Destination Product  Year</span></span>
<span><span class="co">#&gt; Number of fixed-effects     15          15      20    10</span></span>
<span><span class="co">#&gt; Number of references         0           1       1     1</span></span>
<span><span class="co">#&gt; Mean                      23.3        3.09  0.0129 0.157</span></span>
<span><span class="co">#&gt; Standard-deviation        1.28        1.11    1.36 0.113</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; COEFFICIENTS:</span></span>
<span><span class="co">#&gt;   Origin:    AT    BE    DE    DK    ES                 </span></span>
<span><span class="co">#&gt;           22.51 23.56 24.71 23.44 24.97 ... 10 remaining</span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt;   Destination:    AT    BE    DE    DK    ES                 </span></span>
<span><span class="co">#&gt;                2.436 2.696 4.323 2.451 4.043 ... 10 remaining</span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt;   Product: 1     2      3     4      5                 </span></span>
<span><span class="co">#&gt;            0 1.414 0.6562 1.449 -1.521 ... 15 remaining</span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt;   Year: 2007    2008     2009    2010  2011                </span></span>
<span><span class="co">#&gt;            0 0.06912 0.005225 0.07331 0.163 ... 5 remaining</span></span></code></pre></div>
<p>We can see that the fixed-effects are balanced across the dimensions.
Indeed, apart from the first dimension, only one coefficient per
fixed-effect needs to be set as reference (i.e. fixed to 0) to avoid
collinearity across the different fixed-effects dimensions. This ensures
that the fixed-effects coefficients can be compared within a given
fixed-effect dimension. Had there be strictly more than one reference
per fixed-effect dimension, their interpretation would have not been
possible at all. If this was the case though, a warning message would
have been prompted. Note that the mean values are meaningless per se,
but give a reference points to which compare the fixed-effects within a
dimension. Let’s look specifically at the <code>Year</code>
fixed-effects:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixedEffects</span><span class="op">$</span><span class="va">Year</span></span>
<span><span class="co">#&gt;        2007        2008        2009        2010        2011        2012 </span></span>
<span><span class="co">#&gt; 0.000000000 0.069122284 0.005225473 0.073308208 0.163013386 0.192605170 </span></span>
<span><span class="co">#&gt;        2013        2014        2015        2016 </span></span>
<span><span class="co">#&gt; 0.230629376 0.242605404 0.282800683 0.310325692</span></span></code></pre></div>
<p>Finally, the <code>plot</code> method helps to distinguish the most
notable fixed-effects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fixedEffects</span><span class="op">)</span></span></code></pre></div>
<p><img src="fixest_walkthrough_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>For each dimension, the fixed-effects are first centered, then
sorted, and finally the most notable (i.e. highest and lowest) are
reported. The exponential of the coefficient is reported in the right
hand side to simplify the interpretation for models with log-link (as
the Poisson model). As we can see from the country of destination
fixed-effects, trade involving France (FR), Italy (IT) and Germany (DE)
as destination countries is more than 2.7 times higher than the EU15
average. Further, the highest heterogeneity come from the product
category, where trade in product 4 (dairy products) is roughly 2.7 times
the average while product 14 (vegetable plaiting materials) represents a
negligible fraction of the average.</p>
<p>Note however that the interpretation of the fixed-effects must be
taken with extra care. In particular, here the fixed-effects can be
interpreted only because they are perfectly balanced.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-vcov-argument">The vcov argument<a class="anchor" aria-label="anchor" href="#the-vcov-argument"></a>
</h2>
<p>The version 0.10.0 of <code>fixest</code> introduced the argument
<code>vcov</code>. This argument is highly versatile and single-handedly
manages how the standard-errors are computed (note that you can find
many example in <a href="https://lrberge.github.io/fixest/reference/summary.fixest.html#examples">summary.fixest</a>
help pages). This argument can be many things, so bear with me, and now,
let’s start trying to describe it!</p>
<div class="section level3">
<h3 id="basics-main-calls-and-shortcuts">Basics: main calls and shortcuts<a class="anchor" aria-label="anchor" href="#basics-main-calls-and-shortcuts"></a>
</h3>
<p>So far (version 0.10.0), six types of standard-errors can be
computed, here are their keywords and a brief description:</p>
<ul>
<li><p><code>iid</code>: assumes that the error variance is spherical,
i.e. errors are homoskedastic and not correlated (independent and
identically distributed errors have a spherical error
variance).</p></li>
<li><p><code>hetero</code>: assumes that errors are heteroskedastic
(White correction).</p></li>
<li><p><code>cluster</code>, <code>twoway</code>: clustered SEs, assumes
that errors are correlated within the cluster groups.</p></li>
<li><p><code>NW</code>, <code>newey_west</code>: Newey and West (1987)
SEs for time series or panel data, assumes heteroskedastic and serially
correlated errors.</p></li>
<li><p><code>DK</code>, <code>driscoll_kraay</code>: Driscoll and Kraay
(1998) SEs for panel data, assumes cross-sectionally and serially
correlated errors.</p></li>
<li><p><code>conley</code>: Conley (1999) SEs for cross-sections,
assumes spatially correlated errors.</p></li>
</ul>
<p>The most basic uses of the <code>vcov</code> argument are:</p>
<ul>
<li><p>with a character scalar: <code>vcov = "vcov_type"</code> (ex:
<code>vcov = "hetero"</code>).</p></li>
<li><p>with a formula of the form:
<code>vcov = vcov_type ~ variables</code> where the variables are used
to compute the SEs (ex: <code>vcov = DK ~ period</code>).</p></li>
</ul>
<p>Most of the VCOV types need the information on some variables to be
computed. For these types, one then needs to use a formula to inform on
these variables. Let’s give a first example:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span></span>
<span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_did</span><span class="op">)</span></span>
<span><span class="co"># Note that there is partial matching enabled (newey = newey_west)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">newey</span> <span class="op">~</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Standard-errors: Newey-West (L=1) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 1.988753   0.174111 11.4223 1.1709e-06 ***</span></span>
<span><span class="co">#&gt; x1          0.983110   0.052699 18.6551 1.6762e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.89686   Adj. R2: 0.262357</span></span></code></pre></div>
<p>Here we queried Newey-West SEs and provided the panel identifiers in
the right of the formula. Had we used the keyword only, that would have
led to an error:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">"newey_west"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in vcov.fixest(object, vcov = vcov, ssc = ssc, forceCovariance = forceCovariance, : To compute the Newey-West VCOV, we need a variable for the time. Since you didn't provide it in the formula, we typically deduce it from the 'panel.id' identifiers. Problem: no 'panel.id' was set in this estimation. Please provide it in the formula.</span></span></code></pre></div>
<p>But, huh what does the error message says? That the <code>time</code>
variable can be deduced? Indeed, that’s the thing: the algorithm tries
hard to provide sensible default values for the user. Let’s now try with
panel identifiers set at estimation time:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_panel</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_panel</span>, <span class="st">"newey_west"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Standard-errors: Newey-West (L=1) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 1.988753   0.174111 11.4223 1.1709e-06 ***</span></span>
<span><span class="co">#&gt; x1          0.983110   0.052699 18.6551 1.6762e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.89686   Adj. R2: 0.262357</span></span></code></pre></div>
<p>Oh, now it works! However I can see some shade of disappointment in
your eyes: since we need to add <code>panel.id = ~id + period</code> we
end up with more typing! Well, I’m not done: typically we tend to make
many estimations with the same data set, so it may be useful to set some
characteristics globally. This can be done with the
<code><a href="../reference/setFixest_estimation.html">setFixest_estimation()</a></code> function:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setFixest_estimation.html">setFixest_estimation</a></span><span class="op">(</span>panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span></span>
<span><span class="va">est_implicit</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span>, <span class="va">base_did</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_implicit</span>, <span class="st">"newey_west"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Standard-errors: Newey-West (L=1) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 1.988753   0.174111 11.4223 1.1709e-06 ***</span></span>
<span><span class="co">#&gt; x1          0.983110   0.052699 18.6551 1.6762e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.89686   Adj. R2: 0.262357</span></span></code></pre></div>
<p>Although the exact same two lines of code led to an error a few
paragraphs ago, now it works fine.</p>
<p>Here is another example of implicit deduction:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_implicit</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (id) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 1.988753   0.194352 10.2327 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; x1          0.983110   0.046789 21.0115 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.89686   Adj. R2: 0.262357</span></span></code></pre></div>
<p>The SEs are clustered at the unit identifier of the panel. Note that
even if fixed-effects are present, the panel identifier takes precedence
for clustering:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">period</span>, <span class="va">base_did</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: period: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (id) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.997536   0.045721  21.818 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.5526     Adj. R2: 0.357059</span></span>
<span><span class="co">#&gt;                Within R2: 0.297883</span></span></code></pre></div>
<p>Of course, if the panel identifier is missing, the automatic
clustering falls back to the first fixed-effect present:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Removing the panel</span></span>
<span><span class="fu"><a href="../reference/setFixest_estimation.html">setFixest_estimation</a></span><span class="op">(</span>reset <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">period</span>, <span class="va">base_did</span>, <span class="st">"cluster"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: period: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (period) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.997536   0.050264 19.8458 9.7207e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.5526     Adj. R2: 0.357059</span></span>
<span><span class="co">#&gt;                Within R2: 0.297883</span></span></code></pre></div>
<p>Talking about clustered SEs, note that this is such a common
operation that the empty keyword is equivalent to clustered SEs, so that
<code>vcov = ~id + period</code> would lead to SEs clustered by
<code>id</code> and <code>period</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">period</span>, <span class="va">base_did</span>, <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: period: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (id &amp; period) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.997536   0.047498 21.0015 5.8984e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.5526     Adj. R2: 0.357059</span></span>
<span><span class="co">#&gt;                Within R2: 0.297883</span></span></code></pre></div>
<p>Finally, a last example using Conley SEs:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">quakes</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">depth</span> <span class="op">~</span> <span class="va">mag</span>, <span class="va">quakes</span>, <span class="st">"conley"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: depth</span></span>
<span><span class="co">#&gt; Observations: 1,000 </span></span>
<span><span class="co">#&gt; Standard-errors: Conley (90km) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  881.625   110.6727  7.96606 4.4465e-15 ***</span></span>
<span><span class="co">#&gt; mag         -123.421    20.1746 -6.11765 1.3619e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 209.6   Adj. R2: 0.052245</span></span></code></pre></div>
<p>In this case the latitude and longitude are deduced from the
variables names in the data set used for the estimation (here these are
<code>"lat"</code> and <code>"long"</code>). Note that, for convenience,
an automatic distance cutoff is deduced from the data but is not likely
to be the most appropriate! But how to pass your own cutoff as a
parameter? That’s what we’ll see in the next section!</p>
</div>
<div class="section level3">
<h3 id="using-dedicated-functions">Using dedicated functions<a class="anchor" aria-label="anchor" href="#using-dedicated-functions"></a>
</h3>
<p>Some VCOVs require parameters: for example in the Newey-West VCOV,
you need to provide the number of lags to consider. Although it is
automatically deduced via a rule of thumb, the user is likely to want to
use (or test) other values. To provide these extra parameters, you have
two solutions:</p>
<ul>
<li><p>use helper functions which have the same name as the VCOV
keywords (ex: <code>NW</code> or <code>newey_west</code> are two
functions).</p></li>
<li><p>use dedicated VCOV functions (ex: <code>vcov_NW</code>).</p></li>
</ul>
<p>We now cover these two methods in turn. Helper functions can be seen
as supercharged keywords: they are used in place of the VCOV keywords
but also accept arguments. Here are two examples:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">period</span>, <span class="va">base_did</span>, <span class="fu"><a href="../reference/vcov_hac.html">NW</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">~</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: period: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Newey-West (L=2) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.997536   0.049344 20.2159 8.2589e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.5526     Adj. R2: 0.357059</span></span>
<span><span class="co">#&gt;                Within R2: 0.297883</span></span>
<span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">depth</span> <span class="op">~</span> <span class="va">mag</span>, <span class="va">quakes</span>, <span class="fu"><a href="../reference/vcov_conley.html">conley</a></span><span class="op">(</span><span class="fl">200</span>, distance <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: depth</span></span>
<span><span class="co">#&gt; Observations: 1,000 </span></span>
<span><span class="co">#&gt; Standard-errors: Conley (200km) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  881.625   128.2426  6.87467 1.0937e-11 ***</span></span>
<span><span class="co">#&gt; mag         -123.421    22.8950 -5.39074 8.7582e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 209.6   Adj. R2: 0.052245</span></span></code></pre></div>
<p>In the first example, we use the helper function <code><a href="../reference/vcov_hac.html">NW()</a></code>
directly in the formula, exactly where the VCOV type would be. The first
(and only) argument of <code><a href="../reference/vcov_hac.html">NW()</a></code> is the number of lags. On the
right hand side of the formula, we give the variables used to identify
the unit and the time variables, as usual.</p>
<p>In the second example, we use no formula but directly the helper
function <code><a href="../reference/vcov_conley.html">conley()</a></code> for which we provide two arguments: the
cutoff (first argument) and how the distance should be computed. The
latitude and longitude are still deduced from the data. If it could not
be deduced, we would have to provide a formula giving them, like in the
previous example.</p>
<p>There are also dedicated VCOV functions which work in a more standard
way. Let’s redo the same two examples with them:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">period</span>, <span class="va">base_did</span>, <span class="fu"><a href="../reference/vcov_hac.html">vcov_NW</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"period"</span>, lag <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: period: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Newey-West (L=2) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.997536   0.049344 20.2159 8.2589e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.5526     Adj. R2: 0.357059</span></span>
<span><span class="co">#&gt;                Within R2: 0.297883</span></span>
<span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">depth</span> <span class="op">~</span> <span class="va">mag</span>, <span class="va">quakes</span>, <span class="fu"><a href="../reference/vcov_conley.html">vcov_conley</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="st">"lat"</span>, lon <span class="op">=</span> <span class="st">"long"</span>, </span>
<span>                                       cutoff <span class="op">=</span> <span class="fl">200</span>, distance <span class="op">=</span> <span class="st">"spherical"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: depth</span></span>
<span><span class="co">#&gt; Observations: 1,000 </span></span>
<span><span class="co">#&gt; Standard-errors: Conley (200km) </span></span>
<span><span class="co">#&gt;             Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  881.625   128.2426  6.87467 1.0937e-11 ***</span></span>
<span><span class="co">#&gt; mag         -123.421    22.8950 -5.39074 8.7582e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 209.6   Adj. R2: 0.052245</span></span></code></pre></div>
<p>Contrary to the helper functions: a) these functions cannot be used
in a formula, b) they accept the variables to compute the SEs as
arguments. They provide an alternative way to specify the VCOV.</p>
</div>
<div class="section level3">
<h3 id="small-sample-correction">Small sample correction<a class="anchor" aria-label="anchor" href="#small-sample-correction"></a>
</h3>
<p>The value of the SEs can (sometimes quite surprisingly) be impacted
by the type of small sample correction (SSC) applied. In
<code>fixest</code> you can monitor the SSC with the function
<code><a href="../reference/ssc.html">ssc()</a></code>. Details on how the SSCs are computed can be found in
the dedicated vignette: <a href="https://lrberge.github.io/fixest/articles/standard_errors.html">On
standard-errors</a> – here we detail only the implementation.</p>
<p>Most <code>fixest</code> functions accept an <code>ssc</code>
argument that you can readily use. Here’s an example:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base_did</span><span class="op">)</span></span>
<span><span class="va">est_up</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base_did</span>, ssc <span class="op">=</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>fixef.K <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">est_down</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base_did</span>, ssc <span class="op">=</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">est_up</span>, <span class="va">est_down</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                est             est_up           est_down</span></span>
<span><span class="co">#&gt; Dependent Var.:                  y                  y                  y</span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt; x1              0.9615*** (0.0481) 0.9615*** (0.0507) 0.9615*** (0.0478)</span></span>
<span><span class="co">#&gt; Fixed-Effects:  ------------------ ------------------ ------------------</span></span>
<span><span class="co">#&gt; id                             Yes                Yes                Yes</span></span>
<span><span class="co">#&gt; _______________ __________________ __________________ __________________</span></span>
<span><span class="co">#&gt; S.E.: Clustered             by: id             by: id             by: id</span></span>
<span><span class="co">#&gt; Observations                 1,080              1,080              1,080</span></span>
<span><span class="co">#&gt; R2                         0.38715            0.38715            0.38715</span></span>
<span><span class="co">#&gt; Within R2                  0.26507            0.26507            0.26507</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Instead of providing the argument <code>ssc</code>, you can instead
add the <code>ssc</code> call directly within the formula of the
<code>vcov</code>. In this case you should simply add it as a variable.
We now replicate the previous example using a list of several VCOVs in
<code>etable</code> (that’s the only function that accepts lists in the
argument <code>vcov</code>):</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est</span>, vcov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">id</span>, <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>fixef.K <span class="op">=</span> <span class="st">"full"</span><span class="op">)</span>, </span>
<span>                        <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span>, cluster.adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                est              est.1              est.2</span></span>
<span><span class="co">#&gt; Dependent Var.:                  y                  y                  y</span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt; x1              0.9615*** (0.0481) 0.9615*** (0.0507) 0.9615*** (0.0478)</span></span>
<span><span class="co">#&gt; Fixed-Effects:  ------------------ ------------------ ------------------</span></span>
<span><span class="co">#&gt; id                             Yes                Yes                Yes</span></span>
<span><span class="co">#&gt; _______________ __________________ __________________ __________________</span></span>
<span><span class="co">#&gt; S.E.: Clustered             by: id             by: id             by: id</span></span>
<span><span class="co">#&gt; Observations                 1,080              1,080              1,080</span></span>
<span><span class="co">#&gt; R2                         0.38715            0.38715            0.38715</span></span>
<span><span class="co">#&gt; Within R2                  0.26507            0.26507            0.26507</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>You can also tweak <code>iid</code> or <code>hetero</code> SEs using
a formula:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base_did</span>, <span class="va">iid</span> <span class="op">~</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: id: 108</span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.961525   0.048741 19.7272 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.46555     Adj. R2: 0.318981</span></span>
<span><span class="co">#&gt;                 Within R2: 0.265068</span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base_did</span>, <span class="va">hetero</span> <span class="op">~</span> <span class="fu"><a href="../reference/ssc.html">ssc</a></span><span class="op">(</span>adj <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: id: 108</span></span>
<span><span class="co">#&gt; Standard-errors: Heteroskedasticity-robust </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.961525   0.050226 19.1438 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.46555     Adj. R2: 0.318981</span></span>
<span><span class="co">#&gt;                 Within R2: 0.265068</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="other-types-of-vcovs">Other types of VCOVs<a class="anchor" aria-label="anchor" href="#other-types-of-vcovs"></a>
</h3>
<p>Finally, we’re approaching the end of the tour of the
<code>vcov</code> argument. That argument can also accept:</p>
<ul>
<li><p>a matrix, which will be used as the VCOV (possibly useful in
specific contexts)</p></li>
<li><p>a function to be applied to a <code>fixest</code> object to
compute the VCOV.</p></li>
</ul>
<p>The matrix case needs no explanation, let’s have a few lines on the
function. You can provide custom functions to compute the VCOV:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span>, vcov <span class="op">=</span> <span class="fu">sandwich</span><span class="fu">::</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a></span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: id: 108</span></span>
<span><span class="co">#&gt; Standard-errors: vcovHC </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.961525   0.050226 19.1438 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.46555     Adj. R2: 0.318981</span></span>
<span><span class="co">#&gt;                 Within R2: 0.265068</span></span></code></pre></div>
<p>The argument <code>type</code> here is not an argument of
<code>summary</code> but is passed directly to the function
<code>vcovHC</code>. Note that in estimations you can still pass
functions but they must not accept extra arguments. Hence creating you
own wrapper function may be necessary:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">base_did</span>, vcov <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">sandwich</span><span class="fu">::</span><span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a></span><span class="op">(</span><span class="va">x</span>, type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: id: 108</span></span>
<span><span class="co">#&gt; Standard-errors: vcovHC(x, type = "HC1") </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.961525   0.050226 19.1438 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 4.46555     Adj. R2: 0.318981</span></span>
<span><span class="co">#&gt;                 Within R2: 0.265068</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="instrumental-variables">Instrumental variables<a class="anchor" aria-label="anchor" href="#instrumental-variables"></a>
</h2>
<p>Two stage least square estimations can be performed by simply adding
in the formula the link between the endogenous and the instrumental
variables. Let’s have an example.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">=</span> <span class="va">iris</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x_endo_1"</span>, <span class="st">"x_inst_1"</span>, <span class="st">"fe"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">base</span><span class="op">$</span><span class="va">x_inst_2</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">y</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">x_endo_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">150</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">base</span><span class="op">$</span><span class="va">x_endo_2</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">base</span><span class="op">$</span><span class="va">x_inst_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">150</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">est_iv</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">x_endo_1</span> <span class="op">+</span> <span class="va">x_endo_2</span> <span class="op">~</span> <span class="va">x_inst_1</span> <span class="op">+</span> <span class="va">x_inst_2</span>, <span class="va">base</span><span class="op">)</span></span>
<span><span class="va">est_iv</span></span>
<span><span class="co">#&gt; TSLS estimation, Dep. Var.: y, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span></span>
<span><span class="co">#&gt; Second stage: Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  1.831380   0.411435  4.45121 1.6844e-05 ***</span></span>
<span><span class="co">#&gt; fit_x_endo_1 0.444982   0.022086 20.14744  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; fit_x_endo_2 0.639916   0.307376  2.08186 3.9100e-02 *  </span></span>
<span><span class="co">#&gt; x1           0.565095   0.084715  6.67051 4.9180e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.398842   Adj. R2: 0.761653</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_1: stat = 903.2    , p &lt; 2.2e-16 , on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_2: stat =   3.25828, p = 0.041268, on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt;                   Wu-Hausman: stat =   6.79183, p = 0.001518, on 2 and 144 DoF.</span></span></code></pre></div>
<p>So we’ve just performed a two stage least squares estimation. The
formula coming after the pipe,
<code>x_endo_1 + x_endo_2 ~ x_inst_1 + x_inst_2</code>, describes the
endogenous variables (on the left) and the instruments (on the
right).</p>
<p>By default, three statistics are displayed: the F-test from the first
stage (weak instrument test), the Wu-Hausman endogeneity test and the
overidentifying restrictions (Sargan) test. Note that the Sargan
statistic appears only when relevant (i.e. when # instr. &gt; # endo.
vars., not the case here).</p>
<p>You can use the <code>fitstat</code> command to summon other kind of
tests, notably Wald tests on the first/second stages:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fitstat.html">fitstat</a></span><span class="op">(</span><span class="va">est_iv</span>, <span class="op">~</span> <span class="va">ivf1</span> <span class="op">+</span> <span class="va">ivwald1</span> <span class="op">+</span> <span class="va">ivf2</span> <span class="op">+</span> <span class="va">ivwald2</span>, cluster <span class="op">=</span> <span class="st">"fe"</span><span class="op">)</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_1: stat =     903.2    , p &lt; 2.2e-16 , on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_2: stat =       3.25828, p = 0.041268, on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt; Wald (1st stage), x_endo_1  : stat =   1,482.6    , p &lt; 2.2e-16 , on 2 and 146 DoF, VCOV: Clustered (fe).</span></span>
<span><span class="co">#&gt; Wald (1st stage), x_endo_2  : stat =       2.22157, p = 0.112092, on 2 and 146 DoF, VCOV: Clustered (fe).</span></span>
<span><span class="co">#&gt;           F-test (2nd stage): stat =     194.2    , p &lt; 2.2e-16 , on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt;             Wald (2nd stage): stat = 539,363.2    , p &lt; 2.2e-16 , on 2 and 146 DoF, VCOV: Clustered (fe).</span></span></code></pre></div>
<p>As the Wald test relies on a given variance-covariance matrix, you
can pass extra arguments to <code>fitstat</code>, as the argument
<code>cluster</code> in the previous example, to specify which type of
VCOV matrix is desired.</p>
<p>Note that you can display the statistics that you wish when printing
by changing the default print values:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/print.fixest.html">setFixest_print</a></span><span class="op">(</span>fitstat <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">ivwald2</span><span class="op">)</span></span>
<span><span class="va">est_iv</span></span>
<span><span class="co">#&gt; TSLS estimation, Dep. Var.: y, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span></span>
<span><span class="co">#&gt; Second stage: Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;              Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  1.831380   0.411435  4.45121 1.6844e-05 ***</span></span>
<span><span class="co">#&gt; fit_x_endo_1 0.444982   0.022086 20.14744  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; fit_x_endo_2 0.639916   0.307376  2.08186 3.9100e-02 *  </span></span>
<span><span class="co">#&gt; x1           0.565095   0.084715  6.67051 4.9180e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.398842   Adj. R2: 0.761653</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_1: stat = 903.2    , p &lt; 2.2e-16 , on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_2: stat =   3.25828, p = 0.041268, on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt;                   Wu-Hausman: stat =   6.79183, p = 0.001518, on 2 and 144 DoF.</span></span>
<span><span class="co">#&gt;             Wald (2nd stage): stat = 224.0    , p &lt; 2.2e-16 , on 2 and 146 DoF, VCOV: IID.</span></span></code></pre></div>
<p>In the previous code, <code>fitstat = ~ . + ivwald2</code> means that
we want to add the second stage Wald test to the existing printed
statistics (represented here by the point).</p>
<p>Now what about adding some fixed-effects? That’s of course possible,
you need to add them after the first right-hand-side, as follows:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_iv_fe</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">fe</span> <span class="op">|</span> <span class="va">x_endo_1</span> <span class="op">+</span> <span class="va">x_endo_2</span> <span class="op">~</span> <span class="va">x_inst_1</span> <span class="op">+</span> <span class="va">x_inst_2</span>, <span class="va">base</span><span class="op">)</span></span>
<span><span class="va">est_iv_fe</span></span>
<span><span class="co">#&gt; TSLS estimation, Dep. Var.: y, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span></span>
<span><span class="co">#&gt; Second stage: Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Fixed-effects: fe: 3</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (fe) </span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; fit_x_endo_1 0.666671   0.106558 6.25640 0.024608 *  </span></span>
<span><span class="co">#&gt; fit_x_endo_2 0.413839   0.177769 2.32796 0.145344    </span></span>
<span><span class="co">#&gt; x1           0.451680   0.153375 2.94495 0.098553 .  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.327938     Adj. R2: 0.836626</span></span>
<span><span class="co">#&gt;                  Within R2: 0.585907</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_1: stat = 21.6    , p = 6.151e-9, on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt; F-test (1st stage), x_endo_2: stat =  4.78816, p = 0.00968 , on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt;                   Wu-Hausman: stat =  1.31408, p = 0.271968, on 2 and 142 DoF.</span></span>
<span><span class="co">#&gt;             Wald (2nd stage): stat = 19.6    , p = 2.941e-8, on 2 and 146 DoF, VCOV: Clustered (fe).</span></span></code></pre></div>
<p>To access the first stage(s), you can use the summary method:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_iv_fe</span>, stage <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; IV: First stage: x_endo_1</span></span>
<span><span class="co">#&gt; TSLS estimation, Dep. Var.: x_endo_1, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span></span>
<span><span class="co">#&gt; First stage: Dep. Var.: x_endo_1</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Fixed-effects: fe: 3</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (fe) </span></span>
<span><span class="co">#&gt;          Estimate Std. Error t value Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; x_inst_1 0.705992   0.485614 1.45381  0.28320 </span></span>
<span><span class="co">#&gt; x_inst_2 0.202337   0.143302 1.41196  0.29346 </span></span>
<span><span class="co">#&gt; x1       0.189320   0.135622 1.39594  0.29751 </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.346509     Adj. R2: 0.959865</span></span>
<span><span class="co">#&gt;                  Within R2: 0.338407</span></span>
<span><span class="co">#&gt; F-test (1st stage): stat = 21.6, p = 6.151e-9, on 2 and 146 DoF.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; IV: First stage: x_endo_2</span></span>
<span><span class="co">#&gt; TSLS estimation, Dep. Var.: x_endo_2, Endo.: x_endo_1, x_endo_2, Instr.: x_inst_1, x_inst_2</span></span>
<span><span class="co">#&gt; First stage: Dep. Var.: x_endo_2</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Fixed-effects: fe: 3</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (fe) </span></span>
<span><span class="co">#&gt;           Estimate Std. Error  t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x_inst_1 -0.546745   0.081370 -6.71920  0.02144 *  </span></span>
<span><span class="co">#&gt; x_inst_2  0.183092   0.083446  2.19415  0.15946    </span></span>
<span><span class="co">#&gt; x1        0.153198   0.089148  1.71847  0.22785    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.51208     Adj. R2: 0.040133</span></span>
<span><span class="co">#&gt;                 Within R2: 0.063919</span></span>
<span><span class="co">#&gt; F-test (1st stage): stat = 4.78816, p = 0.00968, on 2 and 146 DoF.</span></span></code></pre></div>
<p>When <code>summary</code> shall return more than one element, the
object returned is not a regular <code>fixest</code> object but a
<code>fixest_multi</code> object. These kind of objects are covered in
the vignette: <a href="https://lrberge.github.io/fixest/articles/multiple_estimations.html">Multiple
estimations</a>. You can display the first and second stages in a table
with <code>etable</code>:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_iv_fe</span>, stage <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, fitstat <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">ivfall</span> <span class="op">+</span> <span class="va">ivwaldall.p</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         summary(est_..1 summary(est_iv..2 summary(est_i..3</span></span>
<span><span class="co">#&gt; Dependent Var.:                x_endo_1          x_endo_2                y</span></span>
<span><span class="co">#&gt;                                                                           </span></span>
<span><span class="co">#&gt; x_inst_1                0.7060 (0.4856) -0.5467* (0.0814)                 </span></span>
<span><span class="co">#&gt; x_inst_2                0.2023 (0.1433)   0.1831 (0.0834)                 </span></span>
<span><span class="co">#&gt; x1                      0.1893 (0.1356)   0.1532 (0.0891) 0.4517. (0.1534)</span></span>
<span><span class="co">#&gt; x_endo_1                                                  0.6667* (0.1066)</span></span>
<span><span class="co">#&gt; x_endo_2                                                   0.4138 (0.1778)</span></span>
<span><span class="co">#&gt; Fixed-Effects:          --------------- ----------------- ----------------</span></span>
<span><span class="co">#&gt; fe                                  Yes               Yes              Yes</span></span>
<span><span class="co">#&gt; _______________________ _______________ _________________ ________________</span></span>
<span><span class="co">#&gt; S.E.: Clustered                  by: fe            by: fe           by: fe</span></span>
<span><span class="co">#&gt; Observations                        150               150              150</span></span>
<span><span class="co">#&gt; R2                              0.96121           0.07234          0.84211</span></span>
<span><span class="co">#&gt; Within R2                       0.33841           0.06392          0.58591</span></span>
<span><span class="co">#&gt; F-test (IV only)                 21.581            4.7882           8.3352</span></span>
<span><span class="co">#&gt; Wald (IV only), p-value         2.29e-9           1.32e-9          2.94e-8</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Here we use <code>stage = 1:2</code> to get all first stage
regressions followed by the second stage. Using <code>stage = 2:1</code>
would have done the opposite.</p>
<p>Now some explanations regarding <code>fitstat</code>. The suffix
<code>all</code> concerns IV only and means the following: if it’s a
first stage regression, then the first-stage F-stat is displayed,
otherwise it’s the second stage F-stat. The suffix <code>.p</code> is
used in <code>ivwaldall.p</code> to access the p-value and not the
statistic. Finally, you can permanently set which fit statistic to
display in <code>etable</code> by using <code>setFixest_etable</code>,
like for example
<code>setFixest_etable(fitstat = ~ . + ivfall + ivwaldall.p)</code>.</p>
</div>
<div class="section level2">
<h2 id="interaction-terms">Interaction terms<a class="anchor" aria-label="anchor" href="#interaction-terms"></a>
</h2>
<p>Most R users will be familiar with the base expansion operators for
creating model interaction terms, e.g. <code>x1*x2</code>,
<code>x1:x2</code>, and <code>x1/x2</code>. These base operators all
work with <code>fixest</code> models. However, the package also provides
its own specialized syntax for creating interaction terms and combining
variables. Relative to the base methods, these <code>fixest</code>
methods offer significant performance gains and synergies with the
package’s other functions. To balance performance and convenience, the
exact syntax depends on whether the interaction involves fixed-effects
or not. Here we walk through both categories, further providing examples
of common use-cases.</p>
<div class="section level3">
<h3 id="interactions-involving-fixed-effects">Interactions involving fixed-effects<a class="anchor" aria-label="anchor" href="#interactions-involving-fixed-effects"></a>
</h3>
<p>There are two reasons why we would want to interact variables in the
fixed-effects slot. First, we may simply wish to combine fixed-effects
(e.g. firm × country effects). Second, we wish to allow for varying
slopes (e.g. a time trend for each firm). Let us consider each in turn,
using a lightly modified version of the <code>iris</code> dataset:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Our base data for this section</span></span>
<span><span class="va">base</span> <span class="op">=</span> <span class="va">iris</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"fe1"</span><span class="op">)</span></span>
<span><span class="co"># Create another "fixed-effect"</span></span>
<span><span class="va">base</span><span class="op">$</span><span class="va">fe2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span></span>
<span><span class="co">#&gt;     y  x1  x2  x3    fe1 fe2</span></span>
<span><span class="co">#&gt; 1 5.1 3.5 1.4 0.2 setosa   a</span></span>
<span><span class="co">#&gt; 2 4.9 3.0 1.4 0.2 setosa   b</span></span>
<span><span class="co">#&gt; 3 4.7 3.2 1.3 0.2 setosa   c</span></span>
<span><span class="co">#&gt; 4 4.6 3.1 1.5 0.2 setosa   d</span></span>
<span><span class="co">#&gt; 5 5.0 3.6 1.4 0.2 setosa   e</span></span>
<span><span class="co">#&gt; 6 5.4 3.9 1.7 0.4 setosa   a</span></span></code></pre></div>
<div class="section level4">
<h4 id="combining-several-fixed-effects-fe1fe2fe3---">Combining several fixed-effects (<code>fe1^fe2^fe3...</code>)<a class="anchor" aria-label="anchor" href="#combining-several-fixed-effects-fe1fe2fe3---"></a>
</h4>
<p>Say we want to “combine” the two fixed-effect variables
<code>fe1</code> and <code>fe2</code> to create a brand new fixed-effect
variable. We can do it simply via <code>fixest</code>’s special
<code>^</code> operator:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_comb</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">fe1</span><span class="op">^</span><span class="va">fe2</span>, <span class="va">base</span><span class="op">)</span></span>
<span><span class="va">est_comb</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Fixed-effects: fe1^fe2: 15</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (fe1^fe2) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1 0.782815   0.119465 6.55267 1.2854e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.406785     Adj. R2: 0.729861</span></span>
<span><span class="co">#&gt;                  Within R2: 0.280234</span></span></code></pre></div>
<p>The <code>^</code> operator does the same thing as
<code>paste0(species, "_", fe)</code>, but is more convenient and
significantly faster for large datasets. You can still extract the
fixed-effects the same way:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">est_comb</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;     setosa_a     setosa_b     setosa_c     setosa_d     setosa_e versicolor_a </span></span>
<span><span class="co">#&gt;     2.443630     2.384084     2.164943     2.296256     2.323630     3.713320 </span></span>
<span><span class="co">#&gt; versicolor_b versicolor_c versicolor_d versicolor_e  virginica_a  virginica_b </span></span>
<span><span class="co">#&gt;     3.800694     4.003367     3.745539     3.575086     4.513272     3.986351 </span></span>
<span><span class="co">#&gt;  virginica_c  virginica_d  virginica_e </span></span>
<span><span class="co">#&gt;     4.423725     4.216804     4.159382</span></span></code></pre></div>
<p>Note further that more than two fixed-effects can be combined in
exactly the same manner (e.g. <code>fe1^fe2^fe3</code>), and the syntax
carries over to multivariate clustering too
(e.g. <code>cluster = ~fe1^fe2^fe3</code>).</p>
</div>
<div class="section level4">
<h4 id="varying-slopes-fex">Varying slopes (<code>fe[x]</code>)<a class="anchor" aria-label="anchor" href="#varying-slopes-fex"></a>
</h4>
<p>You can introduce variables with varying slopes directly into the
fixed-effects part of the formula using square brackets
(<code>[]</code>). Recall that varying slopes allow us to flexibly
control for heterogeneous effects across groups. Common real-life
examples could be the inclusion of time trends for each observational
unit (e.g. country), or allowing for the effect of some control variable
(e.g. income) to be moderated by a fixed-effect (e.g. gender). Here we
demonstrate by continuing with our simple dataset.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span></span>
<span><span class="co">#&gt;     y  x1  x2  x3    fe1 fe2</span></span>
<span><span class="co">#&gt; 1 5.1 3.5 1.4 0.2 setosa   a</span></span>
<span><span class="co">#&gt; 2 4.9 3.0 1.4 0.2 setosa   b</span></span>
<span><span class="co">#&gt; 3 4.7 3.2 1.3 0.2 setosa   c</span></span>
<span><span class="co">#&gt; 4 4.6 3.1 1.5 0.2 setosa   d</span></span>
<span><span class="co">#&gt; 5 5.0 3.6 1.4 0.2 setosa   e</span></span>
<span><span class="co">#&gt; 6 5.4 3.9 1.7 0.4 setosa   a</span></span></code></pre></div>
<p>Say we want to estimate <code>y</code> as a function of
<code>x1</code>, but controlling for <code>x2</code>. Moreover, we think
that the slope coefficient of our <code>x2</code> control variable
should be allowed to vary by the <code>fe1</code> fixed-effect variable.
We can do this as follows:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_vs</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">|</span> <span class="va">fe1</span><span class="op">[</span><span class="va">x2</span><span class="op">]</span>, <span class="va">base</span><span class="op">)</span></span>
<span><span class="va">est_vs</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Fixed-effects: fe1: 3</span></span>
<span><span class="co">#&gt; Varying slopes: x2 (fe1: 3)</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (fe1) </span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value Pr(&gt;|t|) </span></span>
<span><span class="co">#&gt; x1 0.450006   0.156731  2.8712  0.10292 </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.298706     Adj. R2: 0.863506</span></span>
<span><span class="co">#&gt;                  Within R2: 0.178944</span></span></code></pre></div>
<p>If you want to see the slopes for <code>x2</code>, just use the
function <code>fixef</code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">est_vs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fixed-effects/Slope coefficients</span></span>
<span><span class="co">#&gt;                                 fe1 x2 (slopes: fe1)</span></span>
<span><span class="co">#&gt; Number of fixed-effects/slopes    3                3</span></span>
<span><span class="co">#&gt; Number of references              0                0</span></span>
<span><span class="co">#&gt; Mean                            1.7            0.639</span></span>
<span><span class="co">#&gt; Standard-deviation             1.32            0.262</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; COEFFICIENTS:</span></span>
<span><span class="co">#&gt;   fe1: setosa versicolor virginica</span></span>
<span><span class="co">#&gt;         2.926      1.879    0.3068</span></span>
<span><span class="co">#&gt; -----</span></span>
<span><span class="co">#&gt;   x2 (slopes: fe1): setosa versicolor virginica</span></span>
<span><span class="co">#&gt;                     0.3677     0.6598    0.8903</span></span></code></pre></div>
<p>Note that this produces the same result as
<code>feols(y ~ x1 + fe1/x2, base)</code>, but is much more performant
for large datasets. The trade-off from the <code>fe1[x2]</code> method
is that we lose the ability to estimate confidence intervals on the
resulting slope coefficients. This should be fine in cases where we are
just trying to control for some confounding or nuisance parameters. If
you are interested in conducting statistical inference on the resulting
slope coefficients and require confidence intervals, then you should use
the slower <code>fe1/x2</code> approach instead.</p>
</div>
</div>
<div class="section level3">
<h3 id="interactions-that-dont-involve-fixed-effects">Interactions that don’t involve fixed-effects<a class="anchor" aria-label="anchor" href="#interactions-that-dont-involve-fixed-effects"></a>
</h3>
<p>The preceding interaction examples all took place in the
fixed-effects slot (i.e. after the <code>|</code>). Underneath the hood,
methods like <code>fe1^fe2</code> and <code>fe1[x2]</code> use numerical
shortcuts that greatly speed up computation. This comes at the cost of
being able to do richer inference with the interacted terms —
e.g. construct confidence intervals — since they are swept out of the
model at estimation time. In many cases, this should prove to be a
perfectly acceptable trade-off. After all, the primary motivation for
estimating fixed-effects models in the first place is to remove the
confounding effect of such “nuisance” parameters.</p>
<p>Yet, there are equally many cases where we do want to retain full
inferential information about interaction terms. For example, in a
difference-in-differences (DiD) research design. Here too
<code>fixest</code> offers its own specialized syntax for combining
terms in the model formula: <code><a href="../reference/i.html">i()</a></code>.</p>
<p>As we shall see, <code><a href="../reference/i.html">i()</a></code> is more versatile than just
creating interaction terms. It is also able to coerce individual
variables to a factor and, compared to base R <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor()</a></code>,
does so in a way that allows for better synergies with other
<code>fixest</code> functions like <code>etable</code> and
<code>coefplot</code>/<code>iplot</code>. This will allow us to perform
some common estimation tasks much more easily.</p>
<p>We now illustrate the main uses of <code><a href="../reference/i.html">i()</a></code> with the help of
some examples.</p>
<div class="section level4">
<h4 id="a-compact-syntax-for-factors-and-interactions-i">A compact syntax for factors and interactions: <code>i()</code><a class="anchor" aria-label="anchor" href="#a-compact-syntax-for-factors-and-interactions-i"></a>
</h4>
<p>The function <code><a href="../reference/i.html">i()</a></code> accepts the arguments <code>ref</code>,
and <code>keep</code> which are used to identify which levels to keep.
Here’s an example how to use them:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="va">res_i1</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">Month</span><span class="op">)</span>, <span class="va">airquality</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).</span></span>
<span><span class="va">res_i2</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">Month</span>, ref <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, <span class="va">airquality</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).</span></span>
<span><span class="va">res_i3</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">Month</span>, keep <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, <span class="va">airquality</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 42 observations removed because of NA values (LHS: 37, RHS: 7).</span></span>
<span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_i1</span>, <span class="va">res_i2</span>, <span class="va">res_i3</span>, dict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"6"</span> <span class="op">=</span> <span class="st">"June"</span>, <span class="st">"Month::5"</span> <span class="op">=</span> <span class="st">"May"</span><span class="op">)</span>, </span>
<span>       order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Int|May"</span>, <span class="st">"Mon"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             res_i1             res_i2             res_i3</span></span>
<span><span class="co">#&gt; Dependent Var.:              Ozone              Ozone              Ozone</span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt; May                                 -36.90*** (8.201)  -24.50*** (6.936)</span></span>
<span><span class="co">#&gt; Month = June         5.069 (10.98)   -31.83** (11.05)    -19.46. (10.46)</span></span>
<span><span class="co">#&gt; Month = 7         31.04*** (8.018)     -5.861 (8.146)                   </span></span>
<span><span class="co">#&gt; Month = 8         36.90*** (8.201)                                      </span></span>
<span><span class="co">#&gt; Month = 9            8.912 (7.763)  -27.99*** (7.845)                   </span></span>
<span><span class="co">#&gt; Constant             3.219 (7.919)   40.12*** (7.828)   25.82*** (6.681)</span></span>
<span><span class="co">#&gt; Solar.R         0.1148*** (0.0300) 0.1148*** (0.0300) 0.1253*** (0.0311)</span></span>
<span><span class="co">#&gt; _______________ __________________ __________________ __________________</span></span>
<span><span class="co">#&gt; S.E. type                      IID                IID                IID</span></span>
<span><span class="co">#&gt; Observations                   111                111                111</span></span>
<span><span class="co">#&gt; R2                         0.31974            0.31974            0.22452</span></span>
<span><span class="co">#&gt; Adj. R2                    0.28735            0.28735            0.20278</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Now that we’ve seen the basic <code><a href="../reference/i.html">i()</a></code> functionality with a
single variable, let’s see how it can be put to use in an interaction
context. We will consider two DiD examples of increasing complexity.</p>
</div>
<div class="section level4">
<h4 id="simple-difference-in-differences-twfe">Simple difference-in-differences (TWFE)<a class="anchor" aria-label="anchor" href="#simple-difference-in-differences-twfe"></a>
</h4>
<p>To illustrate <code><a href="../reference/i.html">i()</a></code>’s interaction functionality, we will
estimate treatment effects over time in a simple DiD setup.</p>
<p>Consider the following dataset where some individuals (identified by
the variable <code>id</code>) receive a treatment and others do not (as
represented by the variable <code>treat</code>). The treatment takes
effect from <code>period</code> 6 onward. The data look like this:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample data illustrating the DiD</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span></span>
<span><span class="co">#&gt;             y         x1 id period post treat</span></span>
<span><span class="co">#&gt; 1  2.87530627  0.5365377  1      1    0     1</span></span>
<span><span class="co">#&gt; 2  1.86065272 -3.0431894  1      2    0     1</span></span>
<span><span class="co">#&gt; 3  0.09416524  5.5768439  1      3    0     1</span></span>
<span><span class="co">#&gt; 4  3.78147485 -2.8300587  1      4    0     1</span></span>
<span><span class="co">#&gt; 5 -2.55819959 -5.0443544  1      5    0     1</span></span>
<span><span class="co">#&gt; 6  1.72873240 -0.6363849  1      6    1     1</span></span></code></pre></div>
<p>The empirical approach that we will use here is the canonical two-way
fixed effects (TWFE) model that should be familiar to many empirical
researchers. In a regression context, TWFE essentially amounts to an
interaction between our <code>treat</code> and <code>period</code>
variables. This is easily done using the
<code>i(fact_var, num_var, reference)</code> syntax:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimation of treatment × period effects</span></span>
<span><span class="co"># We also add individual and period fixed-effects:</span></span>
<span><span class="va">est_did</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">period</span>, <span class="va">treat</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="va">base_did</span><span class="op">)</span></span>
<span><span class="va">est_did</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 1,080 </span></span>
<span><span class="co">#&gt; Fixed-effects: id: 108,  period: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (id) </span></span>
<span><span class="co">#&gt;                   Estimate Std. Error   t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1                0.973490   0.045678 21.311868  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; period::1:treat  -1.403045   1.110267 -1.263701 2.0908e-01    </span></span>
<span><span class="co">#&gt; period::2:treat  -1.247511   1.093145 -1.141213 2.5633e-01    </span></span>
<span><span class="co">#&gt; period::3:treat  -0.273206   1.106935 -0.246813 8.0553e-01    </span></span>
<span><span class="co">#&gt; period::4:treat  -1.795721   1.087974 -1.650518 1.0177e-01    </span></span>
<span><span class="co">#&gt; period::6:treat   0.784452   1.028388  0.762798 4.4726e-01    </span></span>
<span><span class="co">#&gt; period::7:treat   3.598897   1.101563  3.267081 1.4609e-03 ** </span></span>
<span><span class="co">#&gt; period::8:treat   3.811766   1.247502  3.055519 2.8366e-03 ** </span></span>
<span><span class="co">#&gt; period::9:treat   4.731426   1.097113  4.312617 3.6041e-05 ***</span></span>
<span><span class="co">#&gt; period::10:treat  6.606229   1.120494  5.895817 4.4031e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 3.83653     Adj. R2: 0.48783 </span></span>
<span><span class="co">#&gt;                 Within R2: 0.389628</span></span></code></pre></div>
<p>Here, <code>i(period, treat, 5)</code> creates a set of interact
terms: One <code>treat</code> dummy for each <code>period</code>, but
excluding period 5 as a reference. While the explicit reference period
is optional, note that we need a reference to avoid the collinearity
problem posed by the <code>id</code> fixed effects. More to the point,
for this DiD analysis we are interested in whether the treatment
generated a sustained impact on our outcome variable relative to the
control group. This makes period 5 (immediately prior to treatment) the
obvious choice to use as our relative anchor. It also demonstrates an
advantage that <code><a href="../reference/i.html">i()</a></code>’s syntax offers over the equivalent base
<code>treat*factor(period)</code> expansion, which would automatically
use period 1 as a reference. Of course, we could specify the levels of
<code>factor(period)</code> ahead of time. But this is rather tedious,
whereas <code><a href="../reference/i.html">i()</a></code> allows us to do so concisely on the fly.</p>
<p>To display the treatment effects on a graph, we can use the function
<code>iplot</code>:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/coefplot.html">iplot</a></span><span class="op">(</span><span class="va">est_did</span><span class="op">)</span></span></code></pre></div>
<p><img src="fixest_walkthrough_files/figure-html/unnamed-chunk-54-1.png" width="672"></p>
<p>The function <code>iplot</code> reports the coefficients of variables
created with <code><a href="../reference/i.html">i()</a></code>, and only them. In case you wanted to
display all the coefficients, including <code>x1</code>, you can use the
function <code>coefplot</code> instead.</p>
</div>
<div class="section level4">
<h4 id="staggered-difference-in-differences-sun-and-abraham-2020">Staggered difference-in-differences (Sun and Abraham, 2020)<a class="anchor" aria-label="anchor" href="#staggered-difference-in-differences-sun-and-abraham-2020"></a>
</h4>
<p><em>Note that the content of this section is only valid for
<code>fixest</code> version 0.9.0 or later.</em></p>
<p>Despite TWFE’s long-standing popularity for DiD designs, recent
research has a shone a light on the biases that it can introduce under
differential timing. For example, under staggered treatment or policy
rollout.</p>
<p>For staggered DiD analyzes, <code>fixest</code> provides the
<code>sunab</code> function for implementing the unbiased method of <a href="https://doi.org/10.1016/j.jeconom.2020.09.006" class="external-link">Sun and Abraham
(2020)</a> — hereafter: SA20. The method is based on the estimation of
<code>treated cohort x time to treatment</code> dummies which are later
aggregated to obtain the average treatment for the treated (ATT) for
each period (or for the full post treatment period).</p>
<p>(Aside: Note that we use <code>time to treatment</code> rather than
just <code>time</code>, because we need to account for the staggered
treatment via a relative time measure.)</p>
<p>Let’s walk through an example with the <code>base_stagg</code> data
set, where (a) different cohorts get the treatment at different periods,
and (b) the effect of the treatment is cohort-specific and increasing
over time. Let’s have a first look at the data:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">base_stagg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">base_stagg</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id year year_treated time_to_treatment treated treatment_effect_true</span></span>
<span><span class="co">#&gt; 2 90    1            2                -1       1                     0</span></span>
<span><span class="co">#&gt; 3 89    1            3                -2       1                     0</span></span>
<span><span class="co">#&gt; 4 88    1            4                -3       1                     0</span></span>
<span><span class="co">#&gt; 5 87    1            5                -4       1                     0</span></span>
<span><span class="co">#&gt; 6 86    1            6                -5       1                     0</span></span>
<span><span class="co">#&gt; 7 85    1            7                -6       1                     0</span></span>
<span><span class="co">#&gt;           x1           y</span></span>
<span><span class="co">#&gt; 2 -1.0947021  0.01722971</span></span>
<span><span class="co">#&gt; 3 -3.7100676 -4.58084528</span></span>
<span><span class="co">#&gt; 4  2.5274402  2.73817174</span></span>
<span><span class="co">#&gt; 5 -0.7204263 -0.65103066</span></span>
<span><span class="co">#&gt; 6 -3.6711678 -5.33381664</span></span>
<span><span class="co">#&gt; 7 -0.3152137  0.49562631</span></span></code></pre></div>
<p>Note that the variable <code>year_treated</code> is set to 1000
(i.e. above the maximum value of <code>year</code>) for the never
treated. Here’s a quick visual depiction of the data. Again, notice the
staggered treatment rollout and time-varying intensity.</p>
<pre><code><span><span class="co">#&gt; [1] "This graph requires ggplot2 which is currently not available."</span></span></code></pre>
<p>With our data in hand, let’s move on to the estimations. We’ll
implement two DiD models:</p>
<ol style="list-style-type: decimal">
<li>A “naive” DiD consisting of a standard TWFE interaction
(i.e. treatment × time_to_treatment).</li>
<li>A DiD using the SA20 method.</li>
</ol>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># "Naive" TWFE DiD (note that the time to treatment for the never treated is -1000)</span></span>
<span><span class="co"># (by using ref = c(-1, -1000) we exclude the period just before the treatment and </span></span>
<span><span class="co"># the never treated)</span></span>
<span><span class="va">res_twfe</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">time_to_treatment</span>, ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">year</span>, <span class="va">base_stagg</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To implement the Sun and Abraham (2020) method,</span></span>
<span><span class="co"># we use the sunab(cohort, period) function</span></span>
<span><span class="va">res_sa20</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="../reference/sunab.html">sunab</a></span><span class="op">(</span><span class="va">year_treated</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|</span> <span class="va">id</span> <span class="op">+</span> <span class="va">year</span>, <span class="va">base_stagg</span><span class="op">)</span></span></code></pre></div>
<p>Let’s compare our results in plot form:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the two TWFE results</span></span>
<span><span class="fu"><a href="../reference/coefplot.html">iplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">res_twfe</span>, <span class="va">res_sa20</span><span class="op">)</span>, sep <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the true results</span></span>
<span><span class="va">att_true</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="va">base_stagg</span><span class="op">$</span><span class="va">treatment_effect_true</span>, <span class="va">base_stagg</span><span class="op">$</span><span class="va">time_to_treatment</span>, <span class="va">mean</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9</span><span class="op">:</span><span class="fl">8</span>, <span class="va">att_true</span>, pch <span class="op">=</span> <span class="fl">15</span>, col <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">17</span><span class="op">)</span>, </span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TWFE"</span>, <span class="st">"Truth"</span>, <span class="st">"Sun &amp; Abraham (2020)"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fixest_walkthrough_files/figure-html/unnamed-chunk-58-1.png" width="700"></p>
<p>As we can see, the TWFE results suffer from varying degrees of bias
due to the staggered rollout. In contrast, the aggregated SA20 results
do a much better job of consistently estimating the true effects.</p>
<p>As a final example, here’s how to get the average treatment effect
for the treated (ATT):</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The full ATT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res_sa20</span>, agg <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 950 </span></span>
<span><span class="co">#&gt; Fixed-effects: id: 95,  year: 10</span></span>
<span><span class="co">#&gt; Standard-errors: Clustered (id) </span></span>
<span><span class="co">#&gt;      Estimate Std. Error  t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; x1   0.994678   0.018378 54.12293 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ATT -1.133749   0.205070 -5.52858 2.882e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.921817     Adj. R2: 0.887984</span></span>
<span><span class="co">#&gt;                  Within R2: 0.876406</span></span></code></pre></div>
<p>This time the aggregation of the coefficients is operated across each
cohort for non-negative time to treatment. Note that the estimated ATT
compares favourably with the true value of -1.</p>
<p>Under the hood, the <code><a href="../reference/sunab.html">sunab()</a></code> function creates
<code>cohort x time to treatment</code> interactions with the function
<code><a href="../reference/i.html">i()</a></code>, the coefficients are then aggregated at the
appropriate level with the function <code>aggregate.fixest</code>. To
obtain the coefficients for each
<code>cohort x time to treatment</code>, one simply needs to remove the
aggregation:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Full disaggregation (you could have used summary instead of etable)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">res_sa20</span>, agg <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   res_sa20</span></span>
<span><span class="co">#&gt; Dependent Var.:                          y</span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt; x1                      0.9947*** (0.0184)</span></span>
<span><span class="co">#&gt; year = -9 x cohort = 10    0.3518 (0.3591)</span></span>
<span><span class="co">#&gt; year = -8 x cohort = 9     0.0339 (0.4714)</span></span>
<span><span class="co">#&gt; year = -8 x cohort = 10   -0.1919 (0.3529)</span></span>
<span><span class="co">#&gt; year = -7 x cohort = 8    -0.5894 (0.7369)</span></span>
<span><span class="co">#&gt; year = -7 x cohort = 9    0.8730. (0.4934)</span></span>
<span><span class="co">#&gt; year = -7 x cohort = 10    0.0195 (0.6034)</span></span>
<span><span class="co">#&gt; year = -6 x cohort = 7    -0.0421 (0.8657)</span></span>
<span><span class="co">#&gt; year = -6 x cohort = 8    -0.6576 (0.5733)</span></span>
<span><span class="co">#&gt; year = -6 x cohort = 9     0.8777 (0.5333)</span></span>
<span><span class="co">#&gt; year = -6 x cohort = 10   -0.4036 (0.3474)</span></span>
<span><span class="co">#&gt; year = -5 x cohort = 6    -0.6580 (0.9134)</span></span>
<span><span class="co">#&gt; year = -5 x cohort = 7    -0.3170 (0.6979)</span></span>
<span><span class="co">#&gt; year = -5 x cohort = 8    -0.2382 (0.4697)</span></span>
<span><span class="co">#&gt; year = -5 x cohort = 9     0.3015 (0.6042)</span></span>
<span><span class="co">#&gt; year = -5 x cohort = 10   -0.5648 (0.4632)</span></span>
<span><span class="co">#&gt; year = -4 x cohort = 5    -0.9835 (0.6345)</span></span>
<span><span class="co">#&gt; year = -4 x cohort = 6     0.3604 (0.8583)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="additional-features">Additional features<a class="anchor" aria-label="anchor" href="#additional-features"></a>
</h2>
<p>Now we present some other features of the package:</p>
<ol style="list-style-type: decimal">
<li><p><a href="#formula-macros">Formula: macros and dot square
brackets</a>.</p></li>
<li><p><a href="#lagging-variables">How to add lead/lags</a>.</p></li>
<li><p><a href="#non-linear-in-parameters-example">Non-linear in
parameter estimation</a>.</p></li>
<li><p><a href="#multi-threading">Parallelism</a>.</p></li>
</ol>
<!-- NOTE: you can't have ":" or "(" in titles to make links --><div class="section level3">
<h3 id="formula-macros-and-dot-square-brackets">Formula: macros and dot square brackets<a class="anchor" aria-label="anchor" href="#formula-macros-and-dot-square-brackets"></a>
</h3>
<div class="section level4">
<h4 id="formula-macros">Formula macros<a class="anchor" aria-label="anchor" href="#formula-macros"></a>
</h4>
<p>It can be useful, to tidy up the workflow or simply for convenience,
to define formula macros: i.e. macro variables each representing several
variables. This package offers two functions to deal with that:
<code>setFixest_fml</code> to set macro variables globally, and
<code>xpd</code> to create a formula with macro variables either
globally defined or defined at run time.</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">=</span> <span class="va">iris</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">base</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="co"># Defining the macro variables</span></span>
<span><span class="fu"><a href="../reference/setFixest_fml.html">setFixest_fml</a></span><span class="op">(</span>..ctrl <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">x2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">x3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Accessing them</span></span>
<span><span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">..ctrl</span><span class="op">)</span></span>
<span><span class="co">#&gt; y ~ x1 + poly(x2, 2) + poly(x3, 2)</span></span>
<span></span>
<span><span class="co"># Definition at run time</span></span>
<span><span class="va">vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x2"</span>, <span class="st">"x2^2"</span>, <span class="st">"x3"</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">..ctrl</span>, ..ctrl <span class="op">=</span> <span class="va">vars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; y ~ x1 + x2</span></span>
<span><span class="co">#&gt; y ~ x1 + x2 + x2^2</span></span>
<span><span class="co">#&gt; y ~ x1 + x2 + x2^2 + x3</span></span></code></pre></div>
<p>Macro variables must start with two dots. As seen in the example,
once set globally they can be directly accessed with <code>xpd</code>.
In the example, <code>xpd</code> redefines the formula at run-time by
having a character vector as input.</p>
<p>All <code>fixest</code> estimations call <code>xpd</code> internally
if appropriate. This means that the following code works just fine:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">..ctrl</span>, <span class="va">base</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;               Estimate Std. Error  t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   4.122797   0.233398 17.66423  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; x1            0.562757   0.075897  7.41470 9.5941e-12 ***</span></span>
<span><span class="co">#&gt; poly(x2, 2)1 12.601293   1.782973  7.06758 6.2621e-11 ***</span></span>
<span><span class="co">#&gt; poly(x2, 2)2  1.635558   0.589023  2.77673 6.2216e-03 ** </span></span>
<span><span class="co">#&gt; poly(x3, 2)1 -2.757047   1.725003 -1.59829 1.1217e-01    </span></span>
<span><span class="co">#&gt; poly(x3, 2)2 -1.055565   0.668027 -1.58012 1.1627e-01    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.30128   Adj. R2: 0.862108</span></span></code></pre></div>
<p>The function <code>xpd</code> also accepts regular expression macros
of the form <code>..("regex")</code> (or <code>regex("regex")</code>).
If these macros are encountered and provided a character
vector/data.frame is in the argument <code>data</code>, then all
variables names matching the regular expression will be placed in the
formula.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">longley</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">Armed.Forces</span> <span class="op">~</span> <span class="va">Population</span> <span class="op">+</span> <span class="fu">regex</span><span class="op">(</span><span class="st">"GNP|ployed"</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">longley</span><span class="op">)</span></span>
<span><span class="co">#&gt; Armed.Forces ~ Population + GNP.deflator + GNP + Unemployed + </span></span>
<span><span class="co">#&gt;     Employed</span></span></code></pre></div>
<p>Again, since <code>xpd</code> is called internally, the following
works:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">Armed.Forces</span> <span class="op">~</span> <span class="va">Population</span> <span class="op">+</span> <span class="fu">regex</span><span class="op">(</span><span class="st">"GNP|ployed"</span><span class="op">)</span>, <span class="va">longley</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: Armed.Forces</span></span>
<span><span class="co">#&gt; Observations: 16 </span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;                 Estimate  Std. Error   t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  4403.682352 4091.847594  1.076209 0.307112    </span></span>
<span><span class="co">#&gt; Population    -22.844324   32.671302 -0.699217 0.500356    </span></span>
<span><span class="co">#&gt; GNP.deflator    7.638472   12.347773  0.618611 0.550003    </span></span>
<span><span class="co">#&gt; GNP             3.150533    3.554170  0.886433 0.396201    </span></span>
<span><span class="co">#&gt; Unemployed     -0.591649    0.389005 -1.520928 0.159248    </span></span>
<span><span class="co">#&gt; Employed      -50.059800   25.348299 -1.974878 0.076522 .  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 36.1   Adj. R2: 0.569345</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="the-dot-square-bracket-operator">The dot square bracket operator<a class="anchor" aria-label="anchor" href="#the-dot-square-bracket-operator"></a>
</h4>
<p>The special operator <code>.[]</code> can be used in
<code>fixest</code> formulas to replace the enclosed item by its value
in the current environment. Let’s give an example:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="va">z</span> <span class="op">=</span> <span class="st">"i(species)"</span></span>
<span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x.</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">.</span><span class="op">[</span><span class="va">z</span><span class="op">]</span>, <span class="va">base</span><span class="op">)</span></span>
<span><span class="co">#&gt; OLS estimation, Dep. Var.: y</span></span>
<span><span class="co">#&gt; Observations: 150 </span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;                      Estimate Std. Error   t value   Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)          3.682982   0.107403 34.291343  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; x2                   0.905946   0.074311 12.191282  &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; x3                  -0.005995   0.156260 -0.038368 9.6945e-01    </span></span>
<span><span class="co">#&gt; species::versicolor -1.598362   0.205706 -7.770113 1.3154e-12 ***</span></span>
<span><span class="co">#&gt; species::virginica  -2.112647   0.304024 -6.948940 1.1550e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; RMSE: 0.333482   Adj. R2: 0.832221</span></span></code></pre></div>
<p>What just happened? When <code>.[]</code> is encountered in a
formula, its value is evaluated and inserted verbatim in the formula.
Further, when the value in brackets is a vector, as many variables are
added in the model. That’s why <code>x.[i]</code> led to
<code>x2 + x3</code>. Of course, numbers can be used directly:
<code>x.[2:3]</code> would have led to the same result.</p>
<p>Variable names in which <code>.[]</code> is in the middle of the name
can also be created, but it has to be nested:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="fu"><a href="../reference/xpd.html">xpd</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span><span class="op">[</span><span class="st">"x.[i]_sq"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; y ~ x1_sq + x2_sq + x3_sq</span></span></code></pre></div>
<p>How does it work? <code>.[stuff]</code> evaluates <code>stuff</code>
and if stuff is a string literal, the function <code>dsb</code>, which
expands anything in <code>.[]</code>, is applied. In the previous
example, <code>dsb("x.[i]_sq")</code> leads to the vector
<code>c("x1_sq", "x2_sq", "x3_sq")</code>. Then vector is then
aggregated with a sum due to the initial <code>.[]</code>, leading to
<code>x1_sq + x2_sq + x3_sq</code> being inserted in the formula.</p>
<p>By default, when <code>stuff</code> is a vector, the aggregation is
done with a sum. But in some instances, it can be interesting to
aggregate with commas: e.g. when you want to perform a stepwise
estimation. To summon comma-aggregation, place a comma right after the
opening square bracket. Here’s an example:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/stepwise.html">csw</a></span><span class="op">(</span><span class="va">x.</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="va">base</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 feols(y ~ csw(..1 feols(y ~ csw(x..2 feols(y ~ csw(x...3</span></span>
<span><span class="co">#&gt; Dependent Var.:                 y                  y                   y</span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt; Constant        6.526*** (0.4789)  2.249*** (0.2480)   1.856*** (0.2508)</span></span>
<span><span class="co">#&gt; x1               -0.2234 (0.1551) 0.5955*** (0.0693)  0.6508*** (0.0667)</span></span>
<span><span class="co">#&gt; x2                                0.4719*** (0.0171)  0.7091*** (0.0567)</span></span>
<span><span class="co">#&gt; x3                                                   -0.5565*** (0.1275)</span></span>
<span><span class="co">#&gt; _______________ _________________ __________________ ___________________</span></span>
<span><span class="co">#&gt; S.E. type                     IID                IID                 IID</span></span>
<span><span class="co">#&gt; Observations                  150                150                 150</span></span>
<span><span class="co">#&gt; R2                        0.01382            0.84018             0.85861</span></span>
<span><span class="co">#&gt; Adj. R2                   0.00716            0.83800             0.85571</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Finally, there is a special shortcut to facilitate multiple
estimations with variable names stored in a vector. If <code>vars</code>
is a vector of variable names, just use <code>.[vars]</code> in the LHS
to perform a multiple estimation:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span><span class="op">)</span> <span class="co"># Equiv. to: dsb("x.[1:3]")</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="va">vars</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="../reference/i.html">i</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span>, <span class="va">base</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      feols(.[vars] ~ ..1 feols(.[vars] ..2 feols(.[vars] ~..3</span></span>
<span><span class="co">#&gt; Dependent Var.:                       x1                x2                 x3</span></span>
<span><span class="co">#&gt;                                                                              </span></span>
<span><span class="co">#&gt; Constant               3.428*** (0.0480) 1.462*** (0.0609) 0.2460*** (0.0289)</span></span>
<span><span class="co">#&gt; species = versicolor -0.6580*** (0.0679) 2.798*** (0.0861)  1.080*** (0.0409)</span></span>
<span><span class="co">#&gt; species = virginica  -0.4540*** (0.0679) 4.090*** (0.0861)  1.780*** (0.0409)</span></span>
<span><span class="co">#&gt; ____________________ ___________________ _________________ __________________</span></span>
<span><span class="co">#&gt; S.E. type                            IID               IID                IID</span></span>
<span><span class="co">#&gt; Observations                         150               150                150</span></span>
<span><span class="co">#&gt; R2                               0.40078           0.94137            0.92888</span></span>
<span><span class="co">#&gt; Adj. R2                          0.39263           0.94057            0.92792</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="lagging-variables">Lagging variables<a class="anchor" aria-label="anchor" href="#lagging-variables"></a>
</h3>
<p>Some methods have been created to easily deal with leads and lags in
a panel setting. First is shown the various ways of how to deal with it
in a <code>fixest</code> estimation, then how to create a panel data
set, last is described a general way to create lead and lag
variables.</p>
<div class="section level4">
<h4 id="lagging-variables-in-an-estimation">Lagging variables in an estimation<a class="anchor" aria-label="anchor" href="#lagging-variables-in-an-estimation"></a>
</h4>
<p>There are two ways to provide leads and/or lags in a
<code>fixest</code> estimation. Either “on-the-fly” by using the
argument <code>panel.id</code>, either by setting up a panel data set
with the function <code>panel</code> (useful if you run multiple models
needing lags and/or leads), described in the next subsection.</p>
<p>To set up the panel on-the-fly, you need to use the
<code>panel.id</code> argument, which will give you access to the
functions <code>f</code> and <code>l</code> to create leads and lags,
respectively. Let’s give an example, using the previous data set, where
we use lags and leads of the explanatory and dependent variables.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est1</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 108 observations removed because of NA values (RHS: 108).</span></span>
<span><span class="va">est2</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="../reference/l.html">f</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span></span>
<span><span class="va">est3</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="va">base_did</span>, panel.id <span class="op">=</span> <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 324 observations removed because of NA values (LHS: 108, RHS: 324).</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est1</span>, <span class="va">est2</span>, <span class="va">est3</span>, order <span class="op">=</span> <span class="st">"f"</span>, drop <span class="op">=</span> <span class="st">"Int"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               est1               est2               est3</span></span>
<span><span class="co">#&gt; Dependent Var.:                  y             f(y,1)             l(y,1)</span></span>
<span><span class="co">#&gt;                                                                         </span></span>
<span><span class="co">#&gt; f(x1,1)                            0.9940*** (0.0542)                   </span></span>
<span><span class="co">#&gt; Constant         2.235*** (0.2032)  2.464*** (0.2233)  2.196*** (0.2110)</span></span>
<span><span class="co">#&gt; x1              0.9948*** (0.0487)    0.0081 (0.0592)   -0.0534 (0.0545)</span></span>
<span><span class="co">#&gt; l(x1,1)            0.0410 (0.0558)    0.0157 (0.0640) 0.9871*** (0.0551)</span></span>
<span><span class="co">#&gt; l(x1,2)                                                  0.0220 (0.0580)</span></span>
<span><span class="co">#&gt; l(x1,3)                                                  0.0102 (0.0639)</span></span>
<span><span class="co">#&gt; _______________ __________________ __________________ __________________</span></span>
<span><span class="co">#&gt; S.E.: Clustered             by: id             by: id             by: id</span></span>
<span><span class="co">#&gt; Observations                   972                864                756</span></span>
<span><span class="co">#&gt; R2                         0.26558            0.25697            0.25875</span></span>
<span><span class="co">#&gt; Adj. R2                    0.26406            0.25438            0.25480</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>First of all, the value of <code>panel.id</code> corresponds to panel
identifiers: first comes the variable identifying the panel-individuals,
then comes the variables identifying the time. In the example, the
<code>panel.id</code> came in the form of a one-sided formula, but it
could equivalently be equal to <code>panel.id = c("id", "period")</code>
or <code>panel.id = "id,period"</code>.</p>
<p>As we can see, in the first estimation, a lag is created with the
function <code>l</code>. The second argument of the function consists of
a vector giving the lags we want. In this case, <code>l(x1, 0:1)</code>
means we want <code>x1</code> and the first lag of <code>x1</code>. This
argument accepts negative values which give leads, as shown in the
second estimation where <code>l(x1, -1:1)</code> means that we want the
first lead of <code>x1</code>, <code>x1</code>, then its first lag. In
this example, we also use the first lead of <code>y</code> as a
dependent variable with <code>f(y)</code>.</p>
</div>
<div class="section level4">
<h4 id="setting-up-a-panel-data-set">Setting up a panel data set<a class="anchor" aria-label="anchor" href="#setting-up-a-panel-data-set"></a>
</h4>
<p>You can set up a panel data set with the function <code>panel</code>.
There are between two and three advantages of doing so. First, if you
have to estimate many models with leads and/or lags, setting up a panel
gives you access to the lagging functions, <code>f</code> and
<code>l</code>, without having to provide the <code>panel.id</code>
argument we’ve seen in the previous subsection. Second, even when you
estimate models with a sub-selection of the panel data, the data set is
still a proper panel, meaning you can still use the lagging functions.
Finally, and only if you are a <code>data.table</code> user, you can use
the lagging functions to create new variables.</p>
<p>Let’s repeat the previous example, now with a panel data set:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setting up the panel</span></span>
<span><span class="va">pdat</span> <span class="op">=</span> <span class="fu"><a href="../reference/panel.html">panel</a></span><span class="op">(</span><span class="va">base_did</span>, <span class="op">~</span><span class="va">id</span> <span class="op">+</span> <span class="va">period</span><span class="op">)</span></span>
<span><span class="co"># Now the panel.id argument is not required</span></span>
<span><span class="va">est1</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 108 observations removed because of NA values (RHS: 108).</span></span>
<span><span class="va">est2</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="fu"><a href="../reference/l.html">f</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 216 observations removed because of NA values (LHS: 108, RHS: 216).</span></span>
<span><span class="co"># You can use sub selections of the panel data</span></span>
<span><span class="va">est_sub</span> <span class="op">=</span> <span class="fu"><a href="../reference/feols.html">feols</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">[</span><span class="op">!</span><span class="va">pdat</span><span class="op">$</span><span class="va">period</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; NOTE: 324 observations removed because of NA values (RHS: 324).</span></span>
<span><span class="fu"><a href="../reference/etable.html">etable</a></span><span class="op">(</span><span class="va">est1</span>, <span class="va">est2</span>, <span class="va">est_sub</span>, order <span class="op">=</span> <span class="st">"f"</span>, drop <span class="op">=</span> <span class="st">"Int"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                               est1               est2           est_sub</span></span>
<span><span class="co">#&gt; Dependent Var.:                  y             f(y,1)                 y</span></span>
<span><span class="co">#&gt;                                                                        </span></span>
<span><span class="co">#&gt; f(x1,1)                            0.9940*** (0.0542)                  </span></span>
<span><span class="co">#&gt; Constant         2.235*** (0.2032)  2.464*** (0.2233) 3.691*** (0.3085)</span></span>
<span><span class="co">#&gt; x1              0.9948*** (0.0487)    0.0081 (0.0592) 1.013*** (0.0707)</span></span>
<span><span class="co">#&gt; l(x1,1)            0.0410 (0.0558)    0.0157 (0.0640)  -0.0063 (0.0779)</span></span>
<span><span class="co">#&gt; _______________ __________________ __________________ _________________</span></span>
<span><span class="co">#&gt; S.E.: Clustered             by: id             by: id            by: id</span></span>
<span><span class="co">#&gt; Observations                   972                864               540</span></span>
<span><span class="co">#&gt; R2                         0.26558            0.25697           0.26258</span></span>
<span><span class="co">#&gt; Adj. R2                    0.26406            0.25438           0.25983</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>Last, if you also use <code>data.table</code>, let’s give an example
of lead/lag creation:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="va">pdat_dt</span> <span class="op">=</span> <span class="fu"><a href="../reference/panel.html">panel</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span>, <span class="op">~</span><span class="va">id</span><span class="op">+</span><span class="va">period</span><span class="op">)</span></span>
<span><span class="co"># we create a lagged value of the variable x1</span></span>
<span><span class="va">pdat_dt</span><span class="op">[</span>, <span class="va">x1_l1</span> <span class="op">:=</span> <span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co"># Now </span></span>
<span><span class="va">pdat_dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1_l1_fill0"</span>, <span class="st">"y_f2"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="../reference/l.html">l</a></span><span class="op">(</span><span class="va">x1</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="../reference/l.html">f</a></span><span class="op">(</span><span class="va">y</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pdat_dt</span><span class="op">)</span></span>
<span><span class="co">#&gt;              y         x1 id period post treat      x1_l1 x1_l1_fill0</span></span>
<span><span class="co">#&gt; 1:  2.87530627  0.5365377  1      1    0     1         NA   0.0000000</span></span>
<span><span class="co">#&gt; 2:  1.86065272 -3.0431894  1      2    0     1  0.5365377   0.5365377</span></span>
<span><span class="co">#&gt; 3:  0.09416524  5.5768439  1      3    0     1 -3.0431894  -3.0431894</span></span>
<span><span class="co">#&gt; 4:  3.78147485 -2.8300587  1      4    0     1  5.5768439   5.5768439</span></span>
<span><span class="co">#&gt; 5: -2.55819959 -5.0443544  1      5    0     1 -2.8300587  -2.8300587</span></span>
<span><span class="co">#&gt; 6:  1.72873240 -0.6363849  1      6    1     1 -5.0443544  -5.0443544</span></span>
<span><span class="co">#&gt;           y_f2</span></span>
<span><span class="co">#&gt; 1:  0.09416524</span></span>
<span><span class="co">#&gt; 2:  3.78147485</span></span>
<span><span class="co">#&gt; 3: -2.55819959</span></span>
<span><span class="co">#&gt; 4:  1.72873240</span></span>
<span><span class="co">#&gt; 5:  6.28423629</span></span>
<span><span class="co">#&gt; 6:  4.76688778</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="creating-laglead-variables">Creating lag/lead variables<a class="anchor" aria-label="anchor" href="#creating-laglead-variables"></a>
</h4>
<p>If you just want to create a single lag/lead variable, a simple and
fast method has been implemented: <code>lag.formula</code>. Let’s give
an example:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_lag</span> <span class="op">=</span> <span class="va">base_did</span></span>
<span><span class="co"># we create a lagged value of the variable x1</span></span>
<span><span class="va">base_lag</span><span class="op">$</span><span class="va">x1.l1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="fl">1</span>, <span class="va">base_lag</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">base_lag</span><span class="op">)</span></span>
<span><span class="co">#&gt;             y         x1 id period post treat      x1.l1</span></span>
<span><span class="co">#&gt; 1  2.87530627  0.5365377  1      1    0     1         NA</span></span>
<span><span class="co">#&gt; 2  1.86065272 -3.0431894  1      2    0     1  0.5365377</span></span>
<span><span class="co">#&gt; 3  0.09416524  5.5768439  1      3    0     1 -3.0431894</span></span>
<span><span class="co">#&gt; 4  3.78147485 -2.8300587  1      4    0     1  5.5768439</span></span>
<span><span class="co">#&gt; 5 -2.55819959 -5.0443544  1      5    0     1 -2.8300587</span></span>
<span><span class="co">#&gt; 6  1.72873240 -0.6363849  1      6    1     1 -5.0443544</span></span></code></pre></div>
<p>The first two arguments are mandatory. The formula informs on the
variable to be lagged (on the left hand side), and the two panel
identifiers. Note that the time index <strong>must</strong> appear
second. The second argument tells how much lags we want. Using negative
values gives leads. Finally the last argument informs on where to find
the variables.</p>
<p>In case you use the popular package <code>data.table</code>, you can
create lagged variables very simply:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="va">base_lag_dt</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">base_did</span><span class="op">)</span></span>
<span><span class="co"># we create a lagged value of the variable x1</span></span>
<span><span class="va">base_lag_dt</span><span class="op">[</span>, <span class="va">x1.l1</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">x1</span> <span class="op">~</span> <span class="va">id</span> <span class="op">+</span> <span class="va">period</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="non-linear-in-parameters-example">Non-linear in parameters example<a class="anchor" aria-label="anchor" href="#non-linear-in-parameters-example"></a>
</h3>
<p>The function <code>feNmlm</code> is similar to <code>femlm</code> but
allows to have non-linear in parameters right-hand-sides (RHS). First an
example without fixed-effects, the one with fixed-effects is given
later. Let’s say we want to estimate the following relation with a
Poisson model:</p>
<p><span class="math inline">\(E\left(z_i\right) = a\times x_i + b\times
y_i\)</span>.</p>
<p>In fact, this type of model is non-linear in the context of a Poisson
model because the sum is embedded within the log:</p>
<p><span class="math inline">\(E\left(z_i\right) =
\exp\left(\log\left(a\times x_i + b\times
y_i\right)\right)\)</span>.</p>
<p>So let’s estimate such a relation. (Note that you can estimate this
relation with GLM and identity link, but I carry on for the example.)
First we generate the data:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generating data:</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="co"># x and y: two positive random variables</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span></span>
<span><span class="co"># E(z) = 2*x + 3*y and some noise</span></span>
<span><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">base</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span></span></code></pre></div>
<p>To estimate the non-linear relationship, we need to use the argument
<code>NL.fml</code> where we put the non-linear part. We also have to
provide starting values with the argument <code>NL.start</code>.
Finally, to ensure the RHS can be evaluated in any situation, we add
lower bounds for the parameters with the argument
<code>lower</code>.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_NL</span> <span class="op">=</span> <span class="fu"><a href="../reference/feNmlm.html">feNmlm</a></span><span class="op">(</span><span class="va">z</span><span class="op">~</span><span class="fl">0</span>, <span class="va">base</span>, NL.fml <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">b</span><span class="op">*</span><span class="va">y</span><span class="op">)</span>, NL.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that the arguments <code>NL.start</code> and <code>lower</code>
are named lists. Setting <code>lower = list(a=0, b=0)</code> means that
the optimization algorithm will never explore parameters for <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> that are lower than 0. The results
obtained can be interpreted similarly to results with linear RHS. We can
see them with a print:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result_NL</span><span class="op">)</span></span>
<span><span class="co">#&gt; Non-linear ML estimation, family = Poisson, Dep. Var.: z</span></span>
<span><span class="co">#&gt; Observations: 1,000 </span></span>
<span><span class="co">#&gt; Standard-errors: IID </span></span>
<span><span class="co">#&gt;   Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; a  2.02334   0.011217 180.383 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; b  3.02817   0.012684 238.736 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Log-Likelihood: -3,596.8   Adj. Pseudo R2: 0.942674</span></span>
<span><span class="co">#&gt;            BIC:  7,207.5     Squared Cor.: 0.993353</span></span></code></pre></div>
<p>We can see that we obtain coefficients close to the generating
values.</p>
<div class="section level4">
<h4 id="adding-fixed-effects-to-non-linear-in-parameters-models">Adding fixed-effects to non-linear in parameters models<a class="anchor" aria-label="anchor" href="#adding-fixed-effects-to-non-linear-in-parameters-models"></a>
</h4>
<p>Adding fixed-effects is identical to the linear case. The user must
only be well aware of the functional form. Indeed, the fixed-effects
must enter the estimation <strong>linearly</strong>. This means that the
previous equation with one set of fixed-effects writes:</p>
<p><span class="math inline">\(E\left(z_i\right) = \gamma_{id_i} \left(
a\times x_i + b\times y_i \right)\)</span>,</p>
<p>where <span class="math inline">\(id_i\)</span> is the class of
observation <span class="math inline">\(i\)</span> and <span class="math inline">\(\gamma\)</span> is the vector of fixed-effects.
Here the fixed-effects are in fact linear because in the context of the
Poisson model we estimate:</p>
<p><span class="math inline">\(E\left(z_i\right) =
\exp\left(\gamma_{id_i}+\log\left(a\times x_i + b\times
y_i\right)\right)\)</span>.</p>
<p>Further, remark that there exists an infinity of values of <span class="math inline">\(\gamma^{\prime}\)</span>, <span class="math inline">\(a^{\prime}\)</span> and <span class="math inline">\(b^{\prime}\)</span> such that:</p>
<p><span class="math inline">\(\gamma_{k} \left( a\times x_i + b\times
y_i \right) = \gamma_{k}^{\prime} \left(a^{\prime}\times x_i +
b^{\prime}\times y_i \right),\forall i,k\)</span>.</p>
<p>An example is <span class="math inline">\(\gamma^{\prime}_{k} =
2\times \gamma_k\)</span>, <span class="math inline">\(a^{\prime} =
a/2\)</span> and <span class="math inline">\(b^{\prime} = b/2\)</span>.
Thus estimating this relation directly will lead to a problem to
uniquely identify the coefficients. To circumvent this problem, we just
have to fix one of the coefficient, this will ensure that we uniquely
identify them.</p>
<p>Let’s generate this relation:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the class of each observation</span></span>
<span><span class="va">id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">20</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">base</span><span class="op">$</span><span class="va">id</span> <span class="op">=</span> <span class="va">id</span></span>
<span><span class="co"># the vector of fixed-effects</span></span>
<span><span class="va">gamma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">**</span><span class="fl">2</span></span>
<span><span class="co"># the new vector z_bis</span></span>
<span><span class="va">z_bis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">gamma</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">base</span><span class="op">$</span><span class="va">z_bis</span> <span class="op">=</span> <span class="va">z_bis</span></span></code></pre></div>
<p>Now we estimate it with the fixed-effects while fixing one of the
coefficients (we fix <span class="math inline">\(a\)</span> to its true
value but it could be any value):</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># we add the fixed-effect in the formula</span></span>
<span><span class="va">result_NL_fe</span> <span class="op">=</span> <span class="fu"><a href="../reference/feNmlm.html">feNmlm</a></span><span class="op">(</span><span class="va">z_bis</span><span class="op">~</span><span class="fl">0</span><span class="op">|</span><span class="va">id</span>, <span class="va">base</span>, NL.fml <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">b</span><span class="op">*</span><span class="va">y</span><span class="op">)</span>, NL.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># The coef should be around 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">result_NL_fe</span><span class="op">)</span></span>
<span><span class="co">#&gt;        b </span></span>
<span><span class="co">#&gt; 3.024891</span></span>
<span><span class="co"># the gamma and the exponential of the fixed-effects should be similar</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">gamma</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="../reference/fixef_reexported.html">fixef</a></span><span class="op">(</span><span class="va">result_NL_fe</span><span class="op">)</span><span class="op">$</span><span class="va">id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              1         2         3         4           5        6          7</span></span>
<span><span class="co">#&gt; gamma 2.679535 0.1707382 0.7294981 0.6375940 0.002920490 2.202472 0.08203791</span></span>
<span><span class="co">#&gt;       2.670332 0.1831774 0.7519754 0.6240016 0.008805172 2.220800 0.08548657</span></span>
<span><span class="co">#&gt;              8        9       10       11        12       13        14</span></span>
<span><span class="co">#&gt; gamma 1.501218 1.262652 1.515043 1.681641 0.1949462 1.095457 1.0023382</span></span>
<span><span class="co">#&gt;       1.454965 1.276599 1.493300 1.705419 0.1975139 1.104186 0.9971681</span></span>
<span><span class="co">#&gt;              15       16        17        18        19        20</span></span>
<span><span class="co">#&gt; gamma 0.3743722 2.606235 0.5238710 0.1428949 0.4871731 0.1550584</span></span>
<span><span class="co">#&gt;       0.3896577 2.609243 0.5372464 0.1433603 0.4910665 0.1629123</span></span></code></pre></div>
<p>As we can see, we obtain the “right” estimates.</p>
</div>
</div>
<div class="section level3">
<h3 id="multi-threading">Multi-threading<a class="anchor" aria-label="anchor" href="#multi-threading"></a>
</h3>
<p>The package <code>fixest</code> integrates multi-platform parallelism
to hasten the estimation process. By default it makes use of 50% of all
available threads. To change the number of threads used, just use the
argument <code>nthreads</code>:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sample of results:</span></span>
<span><span class="co"># 1 nthreads: 3.13s</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span><span class="op">|</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">+</span><span class="va">Product</span><span class="op">+</span><span class="va">Year</span>, <span class="va">trade</span>, nthreads <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># 2 nthreads: 1.82s</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span><span class="op">|</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">+</span><span class="va">Product</span><span class="op">+</span><span class="va">Year</span>, <span class="va">trade</span>, nthreads <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># 4 nthreads: 1.17s</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="../reference/femlm.html">fenegbin</a></span><span class="op">(</span><span class="va">Euros</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">dist_km</span><span class="op">)</span><span class="op">|</span><span class="va">Origin</span><span class="op">+</span><span class="va">Destination</span><span class="op">+</span><span class="va">Product</span><span class="op">+</span><span class="va">Year</span>, <span class="va">trade</span>, nthreads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As you can see, the efficiency of increasing the number of threads is
not 1 to 1. Two threads do not divide the computing time by 2, nor four
threads by 4. However it still reduces significantly the computing time,
which might be valuable for large sample estimations.</p>
<p>You can permanently set the number of threads used by
<code>fixest</code> using <code>setFixest_nthreads(nthreads)</code>.
Note that you can permanently set this number at the project level by
using the argument save:
<code>setFixest_nthreads(nthreads, save = TRUE)</code>. This way you
won’t need to re-set the number of threads whenever you restart
<em>R</em>.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Laurent Berge.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
